{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/Jnpf/Upload/UploadImg.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/Jnpf/Upload/UploadImg.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport emitter from 'element-ui/src/mixins/emitter'\nlet { methods: { dispatch } } = emitter\nconst units = {\n  KB: 1024,\n  MB: 1024 * 1024,\n  GB: 1024 * 1024 * 1024\n}\nexport default {\n  name: 'UploadImg',\n  props: {\n    value: {\n      type: Array,\n      default: () => []\n    },\n    type: {\n      type: String,\n      default: 'annexpic'\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    simple: {\n      type: Boolean,\n      default: false\n    },\n    detailed: {\n      type: Boolean,\n      default: false\n    },\n    showTip: {\n      type: Boolean,\n      default: false\n    },\n    limit: {\n      type: Number,\n      default: 0\n    },\n    accept: {\n      type: String,\n      default: 'image/*'\n    },\n    sizeUnit: {\n      type: String,\n      default: 'MB'\n    },\n    pathType: {\n      type: String,\n      default: 'defaultPath'\n    },\n    isAccount: {\n      type: Number,\n      default: 0\n    },\n    folder: {\n      type: String,\n      default: ''\n    },\n    fileSize: {\n      default: 10\n    },\n    tipText: {\n      type: String,\n      default: ''\n    }\n  },\n  data() {\n    return {\n      fileList: [],\n      uploadHeaders: { Authorization: this.$store.getters.token },\n    }\n  },\n  watch: {\n    value: {\n      immediate: true,\n      handler(val) {\n        this.fileList = Array.isArray(val) ? val : []\n      }\n    }\n  },\n  computed: {\n    params() {\n      return {\n        pathType: this.pathType,\n        isAccount: this.isAccount,\n        folder: this.folder\n      }\n    }\n  },\n  methods: {\n    beforeUpload(file) {\n      if (this.fileList.length >= this.limit) {\n        this.handleExceed()\n        return false\n      }\n      const unitNum = units[this.sizeUnit];\n      if (!this.fileSize) return true\n      let isRightSize = file.size / unitNum < this.fileSize\n      if (!isRightSize) {\n        this.$message.error(`图片大小超过${this.fileSize}${this.sizeUnit}`)\n        return isRightSize;\n      }\n      let isAccept = new RegExp('image/*').test(file.type)\n      if (!isAccept) {\n        this.$message.error(`请上传图片`)\n        return isAccept;\n      }\n      return isRightSize && isAccept;\n    },\n    handleSuccess(res, file, fileList) {\n      if (this.fileList.length >= this.limit) return this.handleExceed()\n      if (res.code == 200) {\n        this.fileList.push({\n          name: file.name,\n          fileId: res.data.name,\n          url: res.data.url,\n          thumbUrl: res.data.thumbUrl,\n        })\n        this.$emit('input', this.fileList)\n        this.$emit('change', this.fileList)\n        dispatch.call(this, 'ElFormItem', 'el.form.change', this.fileList)\n      } else {\n        this.$refs.elUpload.uploadFiles.splice(fileList.length - 1, 1)\n        fileList.filter(o => o.uid != file.uid)\n        this.$emit('input', this.fileList)\n        this.$emit('change', this.fileList)\n        dispatch.call(this, 'ElFormItem', 'el.form.change', this.fileList)\n        this.$message({ message: res.msg, type: 'error', duration: 1500 })\n      }\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`当前限制最多可以上传${this.limit}张图片`)\n    },\n    handlePictureCardPreview(index) {\n      this.$refs['image' + index][0].clickHandler()\n    },\n    handleRemove(index) {\n      this.fileList.splice(index, 1)\n      this.$refs.elUpload.uploadFiles.splice(index, 1)\n      this.$emit(\"input\", this.fileList)\n      this.$emit('change', this.fileList)\n      dispatch.call(this, 'ElFormItem', 'el.form.change', this.fileList)\n    },\n    getImgList(list) {\n      const newList = list.map(o => this.define.comUrl + o.url)\n      return newList\n    }\n  }\n}\n",null]}