{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/src/mixins/generator/form.js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/mixins/generator/form.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _visualDev = require(\"@/api/onlineDev/visualDev\");\nvar _common = _interopRequireDefault(require(\"@/mixins/generator/common\"));\nvar _dataInterface = require(\"@/api/systemData/dataInterface\");\nvar _default = exports.default = {\n  mixins: [_common.default],\n  data: function data() {\n    return {\n      visible: false,\n      loading: false,\n      activeStep: 0,\n      dataForm: {\n        id: '',\n        fullName: '',\n        enCode: '',\n        type: 1,\n        webType: 2,\n        dbLinkId: '0',\n        sortCode: 0,\n        enableFlow: 0,\n        state: 1,\n        category: '',\n        description: \"\",\n        tables: '',\n        interfaceId: '',\n        interfaceName: ''\n      },\n      dataRule: {\n        fullName: [{\n          required: true,\n          message: '名称不能为空',\n          trigger: 'blur'\n        }],\n        enCode: [{\n          required: true,\n          message: '编码不能为空',\n          trigger: 'blur'\n        }, {\n          validator: this.formValidate('enCode'),\n          trigger: 'blur'\n        }],\n        category: [{\n          required: true,\n          message: '分类不能为空',\n          trigger: 'change'\n        }]\n      },\n      stepLoading: false,\n      maxStep: 1,\n      tables: [],\n      interfaceParam: [],\n      defaultTable: [],\n      formVisible: false,\n      btnLoading: false,\n      formData: null,\n      columnData: null,\n      appColumnData: null,\n      categoryList: [],\n      dbOptions: [],\n      dbType: \"MySQL\",\n      mainTableFields: [],\n      relationTable: \"\",\n      viewFields: []\n    };\n  },\n  methods: {\n    clearValidate: function clearValidate() {\n      var _this = this;\n      this.$nextTick(function () {\n        _this.$refs['dataForm'].clearValidate();\n      });\n    },\n    init: function init(categoryList, id, type, webType, isToggle) {\n      var _this2 = this;\n      this.categoryList = categoryList;\n      this.activeStep = 0;\n      this.tables = [];\n      this.defaultTable = [];\n      this.dataForm.id = id || '';\n      this.getDbOptions();\n      this.visible = true;\n      this.$nextTick(function () {\n        _this2.$refs['dataForm'].resetFields();\n        if (_this2.dataForm.id) {\n          _this2.loading = true;\n          (0, _visualDev.getVisualDevInfo)(_this2.dataForm.id).then(function (res) {\n            _this2.dataForm = res.data;\n            _this2.dataForm.webType = _this2.dataForm.webType || 2;\n            if (isToggle) _this2.dataForm.webType = webType;\n            if (parseInt(_this2.dataForm.webType) == 4) {\n              _this2.maxStep = 1;\n            } else {\n              _this2.maxStep = 2;\n            }\n            _this2.formData = _this2.dataForm.formData && JSON.parse(_this2.dataForm.formData);\n            _this2.columnData = _this2.dataForm.columnData && JSON.parse(_this2.dataForm.columnData);\n            _this2.appColumnData = _this2.dataForm.appColumnData && JSON.parse(_this2.dataForm.appColumnData);\n            _this2.tables = _this2.dataForm.tables && JSON.parse(_this2.dataForm.tables) || [];\n            _this2.interfaceParam = _this2.dataForm.interfaceParam && JSON.parse(_this2.dataForm.interfaceParam) || [];\n            _this2.defaultTable = _this2.dataForm.tables && JSON.parse(_this2.dataForm.tables) || [];\n            _this2.updateFields(_this2.dataForm.webType);\n          }).catch(function () {\n            _this2.loading = false;\n          });\n        } else {\n          _this2.dataForm.type = type;\n          _this2.dataForm.webType = webType || 2;\n          if (parseInt(_this2.dataForm.webType) == 4) {\n            _this2.maxStep = 1;\n          } else {\n            _this2.maxStep = 2;\n          }\n        }\n      });\n    },\n    onUseSearchChange: function onUseSearchChange(e, record) {\n      record.defaultValue = undefined;\n      record.disabled = e;\n    },\n    dataFormSubmit: function dataFormSubmit() {\n      var _this3 = this;\n      var getData = function getData() {\n        _this3.dataForm.tables = JSON.stringify(_this3.tables);\n        _this3.dataForm.formData = _this3.formData ? JSON.stringify(_this3.formData) : null;\n        _this3.dataForm.columnData = _this3.columnData ? JSON.stringify(_this3.columnData) : null;\n        _this3.dataForm.appColumnData = _this3.appColumnData ? JSON.stringify(_this3.appColumnData) : null;\n        _this3.dataForm.interfaceParam = _this3.interfaceParam ? JSON.stringify(_this3.interfaceParam) : null;\n        _this3.$store.state.generator.ruleData = [];\n      };\n      if (this.dataForm.webType == 4 && !this.viewFields.length) {\n        this.$message.warning('请先设置数据接口的字段列表！');\n        return;\n      }\n      if (!this.activeStep) {\n        this.$refs['dataForm'].validate(function (valid) {\n          if (valid) {\n            if (!_this3.tables.length) {\n              var type = _this3.dataForm.type;\n              if (_this3.defaultTable.length || type == 3 || type == 4) {\n                _this3.$message.warning('请至少选择一个数据表');\n                return;\n              }\n            }\n            getData();\n            _this3.formSubmit();\n          }\n        });\n      } else if (this.activeStep == 1) {\n        if (this.dataForm.webType == 4) {\n          this.$refs['columnDesign'].getData().then(function (res) {\n            _this3.columnData = res.columnData;\n            _this3.appColumnData = res.appColumnData;\n            getData();\n            _this3.formSubmit();\n          }).catch(function (err) {\n            err.msg && _this3.$message.warning(err.msg);\n          });\n          return;\n        }\n        this.$refs['generator'].getData().then(function (res) {\n          _this3.formData = res.formData;\n          getData();\n          _this3.formSubmit();\n        }).catch(function (err) {\n          err.msg && _this3.$message.warning(err.msg);\n        });\n      } else if (this.activeStep == 2) {\n        if (this.dataForm.webType == 1) {\n          getData();\n          this.formSubmit();\n        } else {\n          this.$refs['columnDesign'].getData().then(function (res) {\n            _this3.columnData = res.columnData;\n            _this3.appColumnData = res.appColumnData;\n            getData();\n            _this3.formSubmit();\n          }).catch(function (err) {\n            err.msg && _this3.$message.warning(err.msg);\n          });\n        }\n      }\n    },\n    formSubmit: function formSubmit() {\n      var _this4 = this;\n      this.btnLoading = true;\n      var formMethod = this.dataForm.id ? _visualDev.Update : _visualDev.Create;\n      formMethod(this.dataForm).then(function (res) {\n        _this4.$message({\n          message: res.msg,\n          type: 'success',\n          duration: 1500,\n          onClose: function onClose() {\n            _this4.btnLoading = false;\n            _this4.closeDialog(true);\n          }\n        });\n      }).catch(function () {\n        _this4.btnLoading = false;\n      });\n    },\n    next: function next() {\n      var _this5 = this;\n      if (this.dataForm.webType == 4 && !this.viewFields.length) {\n        this.$message.warning('请先设置数据接口的字段列表！');\n        return;\n      }\n      if (this.activeStep < 1) {\n        this.$refs['dataForm'].validate(function (valid) {\n          if (valid) {\n            _this5.getDbType();\n            var type = _this5.dataForm.type;\n            if (!_this5.tables.length) {\n              if (_this5.defaultTable.length || type == 3 || type == 4) {\n                _this5.$message.warning('请至少选择一个数据表');\n                return;\n              }\n              _this5.$store.commit('generator/SET_TABLE', false);\n              _this5.$store.commit('generator/SET_ALL_TABLE', []);\n              _this5.$store.commit('generator/UPDATE_FORMITEM_LIST', []);\n              _this5.activeStep += 1;\n            } else {\n              if (!_this5.exist()) return;\n              var subTable = _this5.tables.filter(function (o) {\n                return o.typeId == '0';\n              });\n              _this5.$store.commit('generator/UPDATE_SUB_TABLE', subTable);\n              _this5.$store.commit('generator/SET_ALL_TABLE', _this5.tables);\n              _this5.$store.commit('generator/SET_DATABASE', _this5.dataForm.dbLinkId);\n              _this5.$store.commit('generator/SET_TABLE', true);\n              _this5.$store.commit('generator/UPDATE_FORMITEM_LIST', _this5.mainTableFields);\n              _this5.activeStep += 1;\n            }\n          }\n        });\n      } else if (this.activeStep == 1) {\n        this.$refs['generator'].getData().then(function (res) {\n          _this5.formData = res.formData;\n          _this5.activeStep += 1;\n        }).catch(function (err) {\n          err.msg && _this5.$message.warning(err.msg);\n        });\n      } else {\n        this.$refs['columnDesign'].getData().then(function (res) {\n          _this5.columnData = res.columnData;\n          _this5.appColumnData = res.appColumnData;\n          _this5.activeStep += 1;\n        }).catch(function (err) {\n          err.msg && _this5.$message.warning(err.msg);\n        });\n      }\n    },\n    changeList: function changeList(type) {\n      var _this6 = this;\n      this.$confirm(type == 1 ? '关闭后，将切换为纯表单模式' : '开启后，将切换为表单+列表模式', '提示', {\n        type: 'warning'\n      }).then(function () {\n        _this6.dataForm.webType = type == 1 ? 1 : 2;\n      }).catch(function () {});\n    },\n    onInterfaceChange: function onInterfaceChange(id, row) {\n      this.viewFields = [];\n      if (!id) {\n        this.dataForm.interfaceId = '';\n        this.dataForm.interfaceName = '';\n        this.interfaceParam = [];\n        return;\n      }\n      this.viewFields = row.fieldJson ? JSON.parse(row.fieldJson) : [];\n      if (this.dataForm.interfaceId === id) return;\n      this.dataForm.interfaceId = id;\n      this.dataForm.interfaceName = row.fullName;\n      this.interfaceParam = row.templateJson || [];\n    }\n  }\n};",null]}