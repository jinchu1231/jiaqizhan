{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/system/printDev/ts-print-templater/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/system/printDev/ts-print-templater/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es7.array.includes\");\nrequire(\"core-js/modules/es6.string.includes\");\nrequire(\"core-js/modules/es6.number.constructor\");\nvar _tsDesignerTinymce = _interopRequireDefault(require(\"./ts-designer-tinymce\"));\nvar _dictionary = require(\"@/api/systemData/dictionary\");\nvar _pageSize = _interopRequireDefault(require(\"./pageSize\"));\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default2 = exports.default = {\n  name: \"tsPrintTemplater\",\n  components: {\n    TsDesignerTinymce: _tsDesignerTinymce.default,\n    pageSize: _pageSize.default\n  },\n  props: {\n    value: String,\n    type: Number,\n    treeData: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    pageParam: {\n      type: Object,\n      default: {}\n    }\n  },\n  data: function data() {\n    return {\n      node: '',\n      btnLoading: false,\n      formLoading: false,\n      dialogVisible: false,\n      dicOptions: [],\n      showEdit: false,\n      tabs: [],\n      initConfig: {},\n      menuList: [],\n      init: {},\n      menuIndex: \"\",\n      content: \"\",\n      activeTab: \"\",\n      richHeight: document.documentElement.clientHeight - 42,\n      systemData: [{\n        fullName: \"打印人员\",\n        id: \"systemPrinter\"\n      }, {\n        fullName: \"打印时间\",\n        id: \"systemPrintTime\"\n      }, {\n        fullName: \"审批内容\",\n        id: \"systemApprovalContent\"\n      }, {\n        fullName: \"图片\",\n        id: \"img\"\n      }, {\n        fullName: \"二维码\",\n        id: \"qrCode\"\n      }, {\n        fullName: \"条形码\",\n        id: \"barCode\"\n      }],\n      parameter: [{\n        fullName: \"千位分隔符(字段或数字,小数位数)\",\n        id: \"thousands\"\n      }, {\n        fullName: \"大写金额(字段或数字)\",\n        id: \"isAmountChinese\"\n      }, {\n        fullName: \"数据字典(字段,字典分类)\",\n        id: \"jnpfDictionary\"\n      }, {\n        fullName: \"日期选择(字段,日期格式)\",\n        id: \"jnpfDate\"\n      }],\n      defaultProps: {\n        children: \"children\",\n        label: \"fullName\"\n      },\n      dataForm: {\n        dictionaryType: ''\n      },\n      dataRule: {\n        dictionaryType: [{\n          required: true,\n          message: \"数据字典不能为空\",\n          trigger: \"click\"\n        }]\n      }\n    };\n  },\n  watch: {\n    pageParam: {\n      handler: function handler(val) {\n        this.getEditConfig(val);\n      },\n      immediate: true,\n      deep: true\n    },\n    value: {\n      handler: function handler(val) {\n        if (val != this.content) this.content = val;\n      },\n      immediate: true,\n      deep: true\n    },\n    content: function content() {\n      this.$emit(\"input\", this.content);\n    }\n  },\n  computed: {\n    editor: function editor() {\n      return this.$refs.createTinymce.editor;\n    },\n    newData: function newData() {\n      return this.treeData;\n    },\n    newSysData: function newSysData() {\n      var data = this.systemData;\n      if (this.type == 2) {\n        data = this.systemData.filter(function (o) {\n          return o.id !== \"systemApprovalContent\";\n        });\n      }\n      return data;\n    }\n  },\n  methods: {\n    handleNodeClick: function handleNodeClick(item, node) {\n      if (item.children != null && item.children.length > 0) return;\n      var tableParent = this.getCurrentParentByTag('table[data-wk-table-tag=\"table\"]');\n      if (!tableParent) {\n        if (item.id == 'jnpfDictionary') return this.getDictionary(node);\n        this.editor.insertContent(this.getSpanNode(item, node));\n        this.content = this.editor.getContent({\n          format: \"html\"\n        });\n      }\n    },\n    getDictionary: function getDictionary(node) {\n      var _this2 = this;\n      this.node = node;\n      this.dialogVisible = true;\n      this.dataForm.dictionaryType = '';\n      (0, _dictionary.getDictionaryTypeSelector)().then(function (res) {\n        _this2.dicOptions = res.data.list.filter(function (o) {\n          return o.children && o.children.length;\n        });\n      });\n    },\n    submit: function submit() {\n      var _this3 = this;\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          _this3.editor.insertContent(_this3.getSpanNode({\n            id: 'jnpfDictionary'\n          }, _this3.node));\n          _this3.content = _this3.editor.getContent({\n            format: \"html\"\n          });\n          _this3.dialogVisible = false;\n        }\n      });\n    },\n    getEditConfig: function getEditConfig(e) {\n      var _this4 = this;\n      if (!e) {\n        e = {};\n        e.mt = 10;\n        e.mb = 10;\n        e.ml = 10;\n        e.mr = 10;\n        e.width = 210;\n        e.height = 297;\n        e.direction = \"纵向\";\n        e.type = '2';\n        this.$emit(\"pageParamInit\", e);\n      }\n      this.$emit(\"pageParamChange\", e);\n      var mt = e.mt;\n      var mb = e.mb;\n      var ml = e.ml;\n      var mr = e.mr;\n      var width = e.width ? e.width : 297;\n      var height = e.height ? e.height : 'calc(100% - 10px)';\n      this.initConfig = {\n        menubar: false,\n        toolbar_sticky: true,\n        statusbar: false,\n        content_style: \"html {\\n          background: #fff;\\n          padding: 20px 0;\\n          box-sizing: border-box;\\n          padding-bottom:20px;\\n        }\\n        body {\\n          font-family: simsun, serif, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\\n          width: \".concat(width, \"mm;\\n          height: \").concat(height, \"mm;\\n          padding: \").concat(mt, \"mm \").concat(mr, \"mm \").concat(mb, \"mm \").concat(ml, \"mm !important;\\n          margin: 0 auto !important;\\n          background: white;\\n          min-height: 100%;\\n          box-sizing: border-box;\\n          box-shadow: 0 2px 12px 0 rgb(0 0 0 / 10%);\\n          word-break:break-all;\\n        }\\n        .wk-tiny-color--customer {\\n          color: #005AF3;\\n        }\\n        .wk-tiny-color--contacts {\\n          color: #1CB24C;\\n        }\\n        .wk-tiny-color--business {\\n          color: #FF852F;\\n        }\\n        .wk-tiny-color--contract {\\n          color: #FF4A43;\\n        }\\n        .wk-tiny-color--receivables {\\n          color: #FFAE46;\\n        }\\n        .wk-tiny-color--product {\\n          color: #00D0D4;\\n        }\\n        .wk-tiny-color--common {\\n          color: #2362FB;\\n        }\\n        p { margin: 5px 0; line-height: 1.5;}\"),\n        table_advtab: false,\n        table_cell_advtab: false,\n        table_row_advtab: false,\n        toolbar: {\n          type: [String, Array],\n          default: \"code | lineheight | undo redo \"\n        },\n        setup: function setup(editor) {\n          var _this = _this4;\n          editor.ui.registry.addButton(\"page\", {\n            text: \"<i class=\\\"el-icon-s-order\\\" style=\\\"font-size:18px\\\"></i>\",\n            tooltip: \"纸张大小\",\n            onAction: function onAction() {\n              _this.$refs.pageSize.dialogFormVisible = true;\n            }\n          });\n          editor.on(\"init\", function () {\n            editor.execCommand(\"mceFocus\");\n          });\n          editor.on(\"keydown\", function (e) {\n            _this4.selectNodes = null;\n            /* Backspace key and del key*/\n            if (e.keyCode === 8 || e.keyCode == 46) {\n              var currentNode = editor.selection.getNode();\n              if (currentNode.getAttribute(\"data-wk-table-td-tag\") === \"value\") {\n                e.preventDefault();\n                return false;\n              } else if (currentNode.nodeName == \"SPAN\") {\n                if (currentNode.hasAttribute(\"contenteditable\")) {\n                  e.preventDefault();\n                  editor.dom.remove(currentNode);\n                  return false;\n                } else {\n                  var span = _this4.getCurrentParentByTag(\"span[contenteditable]\");\n                  if (span) {\n                    e.preventDefault();\n                    editor.dom.remove(span);\n                    return false;\n                  }\n                  if (currentNode.getAttribute(\"data-tag\") === \"thousands\" || currentNode.getAttribute(\"data-tag\") === \"isAmountChinese\") {\n                    if (currentNode.innerHTML.length == 1) {\n                      e.preventDefault();\n                      editor.dom.remove(currentNode);\n                      return false;\n                    }\n                  }\n                }\n              }\n            } else if (e.keyCode == \"65\" && (e.metaKey || e.ctrlKey)) {\n              // 全选\n              _this4.selectNodes = editor.selection.getNode();\n              _this4.setSpanEditAttr(_this4.selectNodes, true);\n            } else {\n              // table 里面不允许写内容\n              var _currentNode = editor.selection.getNode();\n              if (_currentNode.getAttribute(\"data-wk-table-td-tag\") === \"value\") {\n                // 只允许输入上下左右\n                if (e.keyCode !== 37 && e.keyCode !== 38 && e.keyCode !== 39 && e.keyCode !== 40) {\n                  e.preventDefault();\n                  return false;\n                }\n              } else if (_currentNode.nodeName == \"SPAN\") {\n                if (_currentNode.hasAttribute(\"contenteditable\")) {\n                  if (_currentNode.getAttribute(\"contenteditable\")) {\n                    e.preventDefault();\n                    _currentNode.setAttribute(\"contenteditable\", false);\n                    return false;\n                  }\n                  return false;\n                } else {\n                  var _span = _this4.getCurrentParentByTag(\"span[contenteditable]\");\n                  if (_span) {\n                    if (_span.getAttribute(\"contenteditable\")) {\n                      e.preventDefault();\n                      _span.setAttribute(\"contenteditable\", false);\n                      return false;\n                    }\n                    return false;\n                  }\n                }\n              }\n              if (e.keyCode == 37 && e.keyCode == 38 && e.keyCode == 39 && e.keyCode == 40) _this4.cancelSpanEdit();\n            }\n          });\n          editor.on(\"mousedown\", function () {\n            _this4.cancelSpanEdit();\n          });\n          editor.on(\"mouseup\", function (e) {\n            var selection = editor.selection.getSel();\n            if (e.target.hasAttribute(\"contenteditable\") && selection.isCollapsed) {\n              _this4.cancelSpanEdit();\n            } else {\n              if (!selection.isCollapsed) {\n                _this4.selectNodes = editor.selection.getNode();\n                _this4.setSpanEditAttr(_this4.selectNodes, true);\n              } else {\n                _this4.cancelSpanEdit();\n              }\n            }\n          });\n        }\n      };\n    },\n    cancelSpanEdit: function cancelSpanEdit() {\n      var _this5 = this;\n      if (this.selectNodes) {\n        setTimeout(function () {\n          var selection = _this5.editor.selection.getSel();\n          if (!selection.isCollapsed) {\n            _this5.setSpanEditAttr(_this5.selectNodes, false);\n            _this5.selectNodes = null;\n          }\n        }, 300);\n      }\n    },\n    setSpanEditAttr: function setSpanEditAttr(node, canEdit) {\n      if (node && node.hasAttribute('contenteditable')) {\n        if (node.getAttribute('contenteditable') != canEdit) node.setAttribute('contenteditable', canEdit);\n      }\n      if (node && node.children) {\n        for (var index = 0; index < node.children.length; index++) {\n          var element = node.children[index];\n          if (element.children) {\n            this.setSpanEditAttr(element, canEdit);\n          } else if (element.hasAttribute('contenteditable')) {\n            if (node.getAttribute('contenteditable') != canEdit) element.setAttribute('contenteditable', canEdit);\n          }\n        }\n      }\n    },\n    getCurrentParentByTag: function getCurrentParentByTag(tag) {\n      return this.editor.dom.getParent(this.editor.selection.getNode(), tag);\n    },\n    getSpanNode: function getSpanNode(item, node) {\n      var parent = node.parent.data != null && node.parent.data.id != null ? node.parent.data.id : \"null\";\n      if (item.id == \"img\" || item.id == \"barCode\" || item.id == \"qrCode\") return \"&lt;\".concat(item.id, \" width='100' height='100'&gt;&lt;/\").concat(item.id, \"&gt;\");\n      if (item.id == 'isAmountChinese') return \"<span  data-tag='isAmountChinese'>\\u5927\\u5199\\u91D1\\u989D(\".concat(parent, \")<span>\");\n      if (item.id == 'thousands') return \"<span  data-tag='thousands'>\\u5343\\u4F4D\\u5206\\u9694\\u7B26(\".concat(parent, \",2)<span>\");\n      if (item.id == 'jnpfDictionary') return \"<span  data-tag='jnpfDictionary'>\\u6570\\u636E\\u5B57\\u5178(\".concat(parent, \",\").concat(this.dataForm.dictionaryType, \")<span>\");\n      if (item.id == 'jnpfDate') return \"<span  data-tag='jnpfDate'>\\u65E5\\u671F\\u9009\\u62E9(\".concat(parent, \",\\\"yyyy-MM-dd\\\")<span>\");\n      return \"<span data-tag=\\\"\".concat(parent, \".\").concat(item.id, \"\\\" class=\\\"wk-print-tag-wukong \").concat(this.getSpanColorClass(), \"\\\" contenteditable=\\\"false\\\">{\").concat(item.id, \"}</span>\");\n    },\n    getSpanColorClass: function getSpanColorClass() {\n      var color = [\"customer\", \"contacts\", \"business\", \"contract\", \"receivables\", \"product\"].includes(this.activeTab) ? this.activeTab : \"common\";\n      return \"wk-tiny-color--\".concat(color);\n    }\n  }\n};",null]}