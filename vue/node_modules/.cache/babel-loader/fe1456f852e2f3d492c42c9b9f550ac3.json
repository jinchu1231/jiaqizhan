{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/workFlow/flowTodo/BatchList.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/workFlow/flowTodo/BatchList.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nrequire(\"core-js/modules/es6.regexp.search\");\nvar _FlowBefore = require(\"@/api/workFlow/FlowBefore\");\nvar _ApproveDialog = _interopRequireDefault(require(\"@/views/workFlow/components/ApproveDialog\"));\nvar _ActionDialog = _interopRequireDefault(require(\"@/views/workFlow/components/ActionDialog\"));\nvar _ErrorForm = _interopRequireDefault(require(\"../components/ErrorForm\"));\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } //\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = exports.default = {\n  components: {\n    ApproveDialog: _ApproveDialog.default,\n    ErrorForm: _ErrorForm.default,\n    ActionDialog: _ActionDialog.default\n  },\n  props: ['categoryList'],\n  data: function data() {\n    return {\n      id: '',\n      title: '',\n      list: [],\n      total: 0,\n      listLoading: false,\n      btnLoading: false,\n      listQuery: {\n        keyword: '',\n        templateId: '',\n        flowId: '',\n        nodeCode: '',\n        flowCategory: '',\n        creatorUserId: '',\n        startTime: '',\n        endTime: '',\n        currentPage: 1,\n        pageSize: 20,\n        sort: 'desc',\n        sidx: ''\n      },\n      templateOptions: [],\n      flowOptions: [],\n      nodeOptions: [],\n      multipleSelection: [],\n      currentBatchType: null,\n      candidateType: 1,\n      userBoxVisible: false,\n      approveVisible: false,\n      pickerOptions: {\n        shortcuts: [{\n          text: '最近一周',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近三个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n            picker.$emit('pick', [start, end]);\n          }\n        }]\n      },\n      pickerVal: [],\n      showAll: false,\n      errorVisible: false,\n      errorNodeList: [],\n      batchOperationData: {}\n    };\n  },\n  watch: {\n    'listQuery.nodeCode': function listQueryNodeCode(val) {\n      this.search();\n    }\n  },\n  methods: {\n    goBack: function goBack() {\n      this.$emit('close');\n    },\n    init: function init() {\n      this.reset();\n      this.getBatchFlowSelector();\n    },\n    initData: function initData() {\n      var _this = this;\n      this.listLoading = true;\n      (0, _FlowBefore.FlowBeforeList)(4, this.listQuery).then(function (res) {\n        _this.list = res.data.list;\n        _this.total = res.data.pagination.total;\n        _this.listLoading = false;\n      });\n    },\n    getBatchFlowSelector: function getBatchFlowSelector() {\n      var _this2 = this;\n      (0, _FlowBefore.getBatchFlowSelector)().then(function (res) {\n        _this2.templateOptions = res.data;\n      });\n    },\n    getBatchFlowJsonList: function getBatchFlowJsonList() {\n      var _this3 = this;\n      (0, _FlowBefore.getBatchFlowJsonList)(this.listQuery.templateId).then(function (res) {\n        _this3.flowOptions = res.data;\n      });\n    },\n    getNodeSelector: function getNodeSelector() {\n      var _this4 = this;\n      (0, _FlowBefore.getNodeSelector)(this.listQuery.flowId).then(function (res) {\n        _this4.nodeOptions = res.data;\n      });\n    },\n    onTemplateIdChange: function onTemplateIdChange(val) {\n      this.listQuery.flowId = '';\n      this.listQuery.nodeCode = '';\n      this.flowOptions = [];\n      this.nodeOptions = [];\n      if (!val) return;\n      this.getBatchFlowJsonList();\n    },\n    onFlowChange: function onFlowChange(val) {\n      this.listQuery.nodeCode = '';\n      if (!val) return this.nodeOptions = [];\n      this.getNodeSelector();\n    },\n    visibleFlowChange: function visibleFlowChange(val) {\n      if (!val) return;\n      if (!this.listQuery.templateId) this.$message.warning('请先选择所属流程');\n    },\n    visibleChange: function visibleChange(val) {\n      if (!val) return;\n      if (!this.listQuery.flowId) this.$message.warning('请先选择所属名称');\n    },\n    handleChange: function handleChange(val) {\n      this.multipleSelection = val;\n    },\n    handleBatch: function handleBatch(batchType) {\n      var _this5 = this;\n      // batchType 0-通过 1-退回 2-转审\n      if (!this.multipleSelection.length) return this.$message.error('请先选择数据');\n      var isDiffer = this.multipleSelection.some(function (o) {\n        return o.flowVersion !== _this5.multipleSelection[0].flowVersion;\n      });\n      if (isDiffer) return this.$message.error('请选择相同的版本审批单');\n      this.currentBatchType = batchType;\n      var item = this.multipleSelection[0];\n      var properties = item.approversProperties ? JSON.parse(item.approversProperties) : {};\n      if (batchType === 0) {\n        if (!properties.hasAuditBtn) return this.$message.error('当前审批节点无通过权限');\n        this.btnLoading = true;\n        var query = {\n          flowId: item.flowId,\n          taskOperatorId: item.id\n        };\n        (0, _FlowBefore.BatchCandidate)(query).then(function (res) {\n          var data = res.data;\n          _this5.btnLoading = false;\n          _this5.candidateType = data.type;\n          var branchList = [];\n          var candidateList = [];\n          if (data.type == 1) {\n            branchList = data.list;\n            _this5.approveVisible = true;\n            _this5.$nextTick(function () {\n              _this5.$refs.approveDialog.init(properties, item.id, 'audit', branchList, candidateList, item.flowId);\n            });\n          }\n          if (data.type == 2) {\n            var list = data.list.filter(function (o) {\n              return o.isCandidates;\n            });\n            candidateList = list.map(function (o) {\n              return _objectSpread(_objectSpread({}, o), {}, {\n                label: '审批人',\n                value: [],\n                rules: [{\n                  required: true,\n                  message: \"\\u5BA1\\u6279\\u4EBA\\u4E0D\\u80FD\\u4E3A\\u7A7A\",\n                  trigger: 'click'\n                }]\n              });\n            });\n            _this5.approveVisible = true;\n            _this5.$nextTick(function () {\n              _this5.$refs.approveDialog.init(properties, item.id, 'audit', branchList, candidateList, item.flowId);\n            });\n          } else {\n            if (!properties.hasSign && !properties.hasOpinion && !properties.hasFreeApprover && !properties.isCustomCopy) {\n              _this5.$confirm('此操作将通过该审批单，是否继续？', '提示', {\n                type: 'warning'\n              }).then(function () {\n                _this5.batchOperation();\n              }).catch(function () {});\n              return;\n            }\n            _this5.approveVisible = true;\n            _this5.$nextTick(function () {\n              _this5.$refs.approveDialog.init(properties, item.id, 'audit', branchList, candidateList, item.flowId);\n            });\n          }\n        }).catch(function () {\n          _this5.btnLoading = false;\n        });\n        return;\n      }\n      if (batchType === 1) {\n        if (!properties.hasRejectBtn) return this.$message.error('当前审批节点无退回权限');\n        (0, _FlowBefore.RejectList)(item.id).then(function (res) {\n          properties.showReject = res.data.isLastAppro;\n          properties.rejectList = res.data.list || [];\n          properties.nodeCode = properties.rejectList[0].nodeCode;\n          if (!properties.hasSign && !properties.hasOpinion && !properties.showReject) {\n            _this5.$confirm('此操作将退回该审批单，是否继续？', '提示', {\n              type: 'warning'\n            }).then(function () {\n              _this5.batchOperation();\n            }).catch(function () {});\n            return;\n          }\n          _this5.approveVisible = true;\n          _this5.$nextTick(function () {\n            _this5.$refs.approveDialog.init(properties, item.id, 'reject', [], [], item.flowId);\n          });\n        }).catch({});\n        return;\n      }\n      if (batchType === 2) {\n        if (!properties.hasTransferBtn) return this.$message.error('当前审批节点无转审权限');\n        this.userBoxVisible = true;\n        this.$nextTick(function () {\n          _this5.$refs.userBox.init(properties, 'transfer');\n        });\n      }\n    },\n    handleTransfer: function handleTransfer(data) {\n      this.batchOperation(data);\n    },\n    batchOperation: function batchOperation(data) {\n      var _this6 = this;\n      if (!data) {\n        data = {\n          branchList: [],\n          copyIds: \"\",\n          freeApproverUserId: \"\",\n          handleOpinion: \"\",\n          signImg: \"\"\n        };\n      }\n      var ids = this.multipleSelection.map(function (o) {\n        return o.id;\n      });\n      var query = _objectSpread(_objectSpread({}, data), {}, {\n        enCode: this.multipleSelection[0].flowCode,\n        batchType: this.currentBatchType,\n        candidateType: this.candidateType,\n        ids: ids\n      });\n      (0, _FlowBefore.BatchOperation)(query).then(function (res) {\n        var errorData = res.data;\n        if (errorData && Array.isArray(errorData) && errorData.length) {\n          _this6.errorNodeList = errorData;\n          _this6.errorVisible = true;\n          _this6.batchOperationData = data;\n        } else {\n          _this6.$message({\n            type: 'success',\n            message: res.msg,\n            duration: 1000,\n            onClose: function onClose() {\n              _this6.initData();\n              _this6.errorVisible = false;\n              _this6.$refs.approveDialog && _this6.$refs.approveDialog.closeDialog();\n              _this6.$refs.userBox && _this6.$refs.userBox.closeDialog();\n            }\n          });\n        }\n      }).catch(function () {\n        _this6.$refs.approveDialog && (_this6.$refs.approveDialog.btnLoading = false);\n        _this6.$refs.userBox && _this6.$refs.userBox.closeDialog();\n        _this6.errorVisible = false;\n      });\n    },\n    handleError: function handleError(data) {\n      this.batchOperationData.errorRuleUserList = data;\n      this.batchOperation(this.batchOperationData);\n    },\n    reset: function reset() {\n      this.list = [];\n      this.nodeOptions = [];\n      this.flowOptions = [];\n      this.pickerVal = [];\n      this.listQuery = {\n        keyword: '',\n        templateId: '',\n        flowId: '',\n        nodeCode: '',\n        flowCategory: '',\n        creatorUserId: '',\n        startTime: '',\n        endTime: '',\n        currentPage: 1,\n        pageSize: 20,\n        sort: 'desc',\n        sidx: ''\n      };\n      this.initData();\n    },\n    search: function search() {\n      if (this.pickerVal && this.pickerVal.length) {\n        this.listQuery.startTime = this.pickerVal[0];\n        this.listQuery.endTime = this.pickerVal[1];\n      } else {\n        this.listQuery.startTime = '';\n        this.listQuery.endTime = '';\n      }\n      this.listQuery.currentPage = 1;\n      this.listQuery.pageSize = 20;\n      this.initData();\n    }\n  }\n};",null]}