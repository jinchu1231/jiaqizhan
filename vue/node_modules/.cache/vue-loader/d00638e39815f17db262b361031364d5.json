{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/system/sysConfig/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/system/sysConfig/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n  getSystemConfig,\n  updateSystemConfig,\n  testQy,\n  testDing,\n  getSynThirdTotal,\n  synAllOrganizeSysToDing,\n  synAllUserSysToDing,\n  synAllOrganizeSysToQy,\n  synAllUserSysToQy,\n  getAdminList,\n  setAdminList\n} from '@/api/system/sysConfig'\nimport singleImg from '@/components/Upload/SingleImg'\n\nexport default {\n  name: 'system-sysConfig',\n  components: { singleImg },\n  data() {\n    return {\n      activeName: 'first',\n      listLoading: false,\n      btnLoading: false,\n      testQyLoading: false,\n      testSyncLoading: false,\n      testDingLoading: false,\n      wechatLoading: false,\n      dingLoading: false,\n      thirdTab: '1',\n      secondTab: '0',\n      visible: false,\n      synchronization: '',\n      name: '',\n      names: '',\n      row: '',\n      baseForm: {\n        title: '',\n        sysName: '',\n        sysDescription: '',\n        sysVersion: '',\n        loginIcon: '',\n        logoIcon: '',\n        appIcon: '',\n        copyright: '',\n        companyName: '',\n        companyCode: '',\n        companyAddress: '',\n        companyContacts: '',\n        companyTelePhone: '',\n        companyEmail: '',\n        singleLogin: '1',\n        tokenTimeout: '1',\n        lastLoginTimeSwitch: 1,\n        whitelistSwitch: 1,\n        whiteListIp: '',\n        qyhCorpId: '',\n        qyhAgentId: '',\n        qyhAgentSecret: '',\n        qyhCorpSecret: '',\n        qyhIsSynOrg: 0,\n        qyhIsSynUser: 0,\n        dingSynAppKey: '',\n        dingSynAppSecret: '',\n        dingAgentId: '',\n        dingSynIsSynOrg: 0,\n        dingSynIsSynUser: 0,\n        passwordErrorsNumber: 0,\n        lockType: 1,\n        lockTime: 10,\n        enableVerificationCode: 0,\n        passwordIsUpdatedRegularly: 0,\n        updateCycle: 0,\n        updateInAdvance: 0,\n        passwordStrengthLimit: 0,\n        passwordLengthMin: false,\n        passwordLengthMinNumber: 0,\n        containsNumbers: false,\n        includeLowercaseLetters: false,\n        includeUppercaseLetters: false,\n        containsCharacters: false,\n        disableOldPassword: 0,\n        disableTheNumberOfOldPasswords: 0,\n        mandatoryModificationOfInitialPassword: 0,\n        linkTime: 24,\n        isClick: 0,\n        unClickNum: 1,\n      },\n      rules: {},\n      wxEvents: [{\n        select: false,\n        title: '启用同步组织',\n        desc: '新增、删除、修改组织信息触发同步组织事件'\n      }, {\n        select: false,\n        title: '启用同步用户',\n        desc: '新增、删除、修改用户信息触发同步用户事件'\n      }],\n      wxResults: [{\n        recordTotal: '',\n        synDate: '',\n        synFailCount: '',\n        synSuccessCount: '',\n        synType: '组织',\n        unSynCount: '',\n      }, {\n        recordTotal: '',\n        synDate: '',\n        synFailCount: '',\n        synSuccessCount: '',\n        synType: '用户',\n        unSynCount: '',\n      }],\n      ddEvents: [{\n        select: false,\n        title: '启用同步组织',\n        desc: '新增、删除、修改组织信息触发同步组织事件'\n      }, {\n        select: false,\n        title: '启用同步用户',\n        desc: '新增、删除、修改用户信息触发同步用户事件'\n      }],\n      ddResults: [{\n        recordTotal: '',\n        synDate: '',\n        synFailCount: '',\n        synSuccessCount: '',\n        synType: '组织',\n        unSynCount: '',\n      }, {\n        recordTotal: '',\n        synDate: '',\n        synFailCount: '',\n        synSuccessCount: '',\n        synType: '用户',\n        unSynCount: '',\n      }],\n      adminIds: []\n    }\n  },\n  watch: {\n    thirdTab: {\n      handler(val) {\n        this.getSynThirdTotal(val)\n      },\n      immediate: true\n    },\n    activeName(val) {\n      if (val === 'fourth') {\n        this.getAdminList()\n      }\n    }\n  },\n  created() {\n    this.activeName = this.$route.query.type == 1 ? 'third' : 'first'\n    this.initData()\n  },\n  methods: {\n    initConfig() {\n      if (!this.baseForm.disableTheNumberOfOldPasswords) this.baseForm.disableTheNumberOfOldPasswords = 1\n      if (!this.baseForm.updateCycle) this.baseForm.updateCycle = 1\n      if (!this.baseForm.updateInAdvance) this.baseForm.updateInAdvance = 1\n      if (!this.baseForm.passwordLengthMinNumber) this.baseForm.passwordLengthMinNumber = 1\n    },\n    initData() {\n      this.listLoading = true\n      this.$nextTick(() => {\n        getSystemConfig().then(res => {\n          this.baseForm = res.data\n          this.wxEvents[0].select = this.baseForm.qyhIsSynOrg ? true : false\n          this.wxEvents[1].select = this.baseForm.qyhIsSynUser ? true : false\n          this.ddEvents[0].select = this.baseForm.dingSynIsSynOrg ? true : false\n          this.ddEvents[1].select = this.baseForm.dingSynIsSynUser ? true : false\n          this.baseForm.smsCompany = this.baseForm.smsCompany ? this.baseForm.smsCompany : '1'\n          this.baseForm.lockType = this.baseForm.lockType ? this.baseForm.lockType : 1\n          this.baseForm.lockTime = this.baseForm.lockTime ? this.baseForm.lockTime : 10\n          this.baseForm.isClick = this.baseForm.isClick ? this.baseForm.isClick : 0\n          this.baseForm.linkTime = this.baseForm.linkTime ? this.baseForm.linkTime : 24\n          this.baseForm.unClickNum = this.baseForm.unClickNum ? this.baseForm.unClickNum : 1\n          this.listLoading = false\n        }).catch(() => {\n          this.listLoading = false\n        })\n      })\n    },\n    checkQy(type) {\n      type === 1 ? this.testSyncLoading = true : this.testQyLoading = true\n      const data = {\n        qyhAgentId: this.baseForm.qyhAgentId,\n        qyhAgentSecret: this.baseForm.qyhAgentSecret,\n        qyhCorpId: this.baseForm.qyhCorpId,\n        qyhCorpSecret: this.baseForm.qyhCorpSecret\n      }\n      testQy(data, type).then(res => {\n        this.$message({\n          message: res.msg,\n          type: 'success',\n          duration: 1500,\n          onClose: () => {\n            type === 1 ? this.testSyncLoading = false : this.testQyLoading = false\n          }\n        })\n      }).catch(() => {\n        type === 1 ? this.testSyncLoading = false : this.testQyLoading = false\n      })\n    },\n    checkDing() {\n      this.testDingLoading = true\n      const data = {\n        dingAgentId: this.baseForm.dingAgentId,\n        dingSynAppKey: this.baseForm.dingSynAppKey,\n        dingSynAppSecret: this.baseForm.dingSynAppSecret\n      }\n      testDing(data).then(res => {\n        this.$message({\n          message: res.msg,\n          type: 'success',\n          duration: 1500,\n          onClose: () => {\n            this.testDingLoading = false\n          }\n        })\n      }).catch(() => {\n        this.testDingLoading = false\n      })\n    },\n    getSynThirdTotal(type) {\n      getSynThirdTotal(type).then(res => {\n        let list = res.data.map(o => ({ loading: false, ...o }))\n        type == '1' ? this.wxResults = list : this.ddResults = list\n      })\n    },\n    syncWechat(row) {\n      this.name = '同步到企业微信'\n      this.names = '把系统数据同步到企业微信'\n      this.synchronization = '把企业微信数据同步到系统'\n      this.row = row || ''\n      this.visible = true\n\n    },\n    syncDingVisible(row) {\n      this.name = '同步到阿里钉钉'\n      this.names = '把系统数据同步到阿里钉钉'\n      this.synchronization = '把阿里钉钉数据同步到系统'\n      this.row = row || ''\n      this.visible = true\n    },\n    syncQy(type) {\n      this.$confirm('同步以后会丢失现有数据，是否继续？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        type == 0 ? this.wechatLoading = true : this.dingLoading = true\n        const method = this.row.synType == '组织' ? synAllOrganizeSysToQy : synAllUserSysToQy\n        method(type).then(res => {\n          type == 0 ? this.wechatLoading = false : this.dingLoading = false\n          this.visible = false\n          if (res.msg === '正在进行同步,请稍等') {\n            this.$message({\n              message: res.msg,\n              type: 'success',\n              duration: 1500,\n            })\n            return\n          }\n          this.row.recordTotal = res.data.recordTotal\n          this.row.synDate = res.data.synDate\n          this.row.synFailCount = res.data.synFailCount\n          this.row.synSuccessCount = res.data.synSuccessCount\n          this.row.synType = res.data.synType\n          this.row.unSynCount = res.data.unSynCount\n          this.$message({\n            message: '同步成功',\n            type: 'success',\n            duration: 1500,\n          })\n        }).catch(() => { type == 0 ? this.wechatLoading = false : this.dingLoading = false })\n      })\n    },\n    syncDing(type) {\n      this.$confirm('同步以后会丢失现有数据，是否继续？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        type == 0 ? this.wechatLoading = true : this.dingLoading = true\n        const method = this.row.synType == '组织' ? synAllOrganizeSysToDing : synAllUserSysToDing\n        method(type).then(res => {\n          type == 0 ? this.wechatLoading = false : this.dingLoading = false\n          this.visible = false\n          if (res.msg === '正在进行同步,请稍等') {\n            this.$message({\n              message: res.msg,\n              type: 'success',\n              duration: 1500,\n            })\n            return\n          }\n          this.row.recordTotal = res.data.recordTotal\n          this.row.synDate = res.data.synDate\n          this.row.synFailCount = res.data.synFailCount\n          this.row.synSuccessCount = res.data.synSuccessCount\n          this.row.synType = res.data.synType\n          this.row.unSynCount = res.data.unSynCount\n          this.$message({\n            message: '同步成功',\n            type: 'success',\n            duration: 1500,\n          })\n        }).catch(() => { type == 0 ? this.wechatLoading = false : this.dingLoading = false })\n      })\n    },\n    submitSmsForm() {\n      this.$refs['baseForm'].validate((valid) => {\n        if (!valid) return\n        this.submitForm()\n      })\n    },\n    submitForm() {\n      this.baseForm.qyhIsSynOrg = this.wxEvents[0].select ? 1 : 0\n      this.baseForm.qyhIsSynUser = this.wxEvents[1].select ? 1 : 0\n      this.baseForm.dingSynIsSynOrg = this.ddEvents[0].select ? 1 : 0\n      this.baseForm.dingSynIsSynUser = this.ddEvents[1].select ? 1 : 0\n      this.baseForm.passwordLengthMin = this.baseForm.passwordLengthMin ? 1 : 0\n      this.baseForm.containsNumbers = this.baseForm.containsNumbers ? 1 : 0\n      this.baseForm.includeLowercaseLetters = this.baseForm.includeLowercaseLetters ? 1 : 0\n      this.baseForm.includeUppercaseLetters = this.baseForm.includeUppercaseLetters ? 1 : 0\n      this.baseForm.containsCharacters = this.baseForm.containsCharacters ? 1 : 0\n      this.$confirm('您确定要保存，是否继续？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        this.btnLoading = true\n        updateSystemConfig(this.baseForm).then(res => {\n          this.$message({\n            message: res.msg,\n            type: 'success',\n            duration: 1500,\n            onClose: () => {\n              this.btnLoading = false\n              const sysConfig = {\n                sysName: this.baseForm.sysName,\n                sysVersion: this.baseForm.sysVersion,\n                loginIcon: this.baseForm.loginIcon,\n                copyright: this.baseForm.copyright,\n                companyName: this.baseForm.companyName,\n                logoIcon: this.baseForm.logoIcon,\n                appIcon: this.baseForm.appIcon,\n                title: this.baseForm.title\n              }\n              this.$store.commit('settings/CHANGE_SETTING', { key: \"sysConfig\", value: sysConfig })\n              this.initData()\n            }\n          })\n        }).catch(() => {\n          this.btnLoading = false\n        })\n      }).catch(() => { this.btnLoading = false })\n    },\n    getAdminList() {\n      getAdminList().then(res => {\n        if (!res.data) return\n        this.adminIds = res.data.map(o => o.id)\n      })\n    },\n    setAdminList() {\n      this.btnLoading = true\n      this.$confirm('您确定要保存，是否继续？', '提示', {\n        type: 'warning'\n      }).then(() => {\n        setAdminList(this.adminIds).then(res => {\n          this.$message({\n            message: res.msg,\n            type: 'success',\n            duration: 1500,\n            onClose: () => {\n              this.btnLoading = false\n            }\n          })\n        })\n      }).catch(() => { this.btnLoading = false })\n    }\n  }\n}\n",null]}