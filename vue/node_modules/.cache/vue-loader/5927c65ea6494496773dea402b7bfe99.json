{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/integrationProcess/FlowCard/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/integrationProcess/FlowCard/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\nimport { NodeUtils } from \"./util.js\";\nconst isCondition = data => data.type === \"condition\" || (data.type === \"addData\" && (data.isInterflow || data.isBranchFlow));\nconst notEmptyArray = arr => Array.isArray(arr) && arr.length > 0;\nconst hasBranch = data => notEmptyArray(data.conditionNodes);\nconst stopPro = ev => ev.stopPropagation();\n\nfunction createNormalCard(ctx, conf, h) {\n  const classList = ['flow-path-card', 'approver']\n  const afterTrue = (isTrue, name) => (isTrue && classList.push(name), isTrue)\n  const isStartNode = afterTrue(NodeUtils.isStartNode(conf), 'start-node')\n  const isApprNode = afterTrue(NodeUtils.isStartNode(conf), 'approver')\n  return (\n    <section class={classList.join(' ')} onClick={this.eventLauncher.bind(ctx, \"edit\", conf)} >\n      <header class=\"header\">\n        <div class=\"title-box\" style=\"height: 100%;width:190px;\">\n          <span class=\"title-text\">{conf.properties.title}</span>\n        </div>\n        {conf.type !== 'getData' && (\n          <div class=\"actions\">\n            <i class=\"el-icon-close icon\" onClick={this.eventLauncher.bind(ctx, \"deleteNode\", conf, ctx.data)} ></i>\n          </div>\n        )}\n      </header>\n      <div class=\"body\">\n        <span class=\"text\">{conf.content}</span>\n      </div>\n    </section>\n  );\n}\n// arg = ctx, data, h\nconst createFunc = (...arg) => createNormalCard.call(arg[0], ...arg)\nlet nodes = {\n  start: createFunc,\n  addData: createFunc,\n  updateData: createFunc,\n  deleteData: createFunc,\n  dataInterface: createFunc,\n  message: createFunc,\n  getData: createFunc,\n  launchFlow: createFunc,\n  interflow: createFunc,\n  branchFlow: createFunc,\n  empty: _ => '',\n  condition: function (ctx, conf, h) {\n    return (\n      <section\n        class=\"flow-path-card condition\"\n        onClick={this.eventLauncher.bind(ctx, \"edit\", conf)}\n      >\n        <header class=\"header\">\n          <div class=\"title-box\" style=\"height:20px;width:160px;\">\n            <span class=\"title-text\">{conf.properties.title}</span>\n            <input vModel_trim={conf.properties.title} class=\"title-input\" onClick={stopPro} />\n          </div>\n          {\n            // <span class=\"priority\">优先级{conf.properties.priority + 1}</span> \n          }\n          <div class=\"actions\">\n            <i class=\"el-icon-close icon\" onClick={this.eventLauncher.bind(ctx, \"deleteNode\", conf, ctx.data)}></i>\n          </div>\n        </header>\n        <div class=\"body\">\n          <div class=\"text\">{conf.content}</div>\n        </div>\n      </section>\n    );\n  }\n};\n\nfunction addNodeButton(ctx, data, h, isBranch = false) {\n  // 只有非条件节点和条件分支树下面的那个按钮 才能添加新分支树\n  let couldAddBranch = !hasBranch(data) || isBranch;\n  let canAddAppendBranch = true\n  let canAddAppendInterflow = true\n  let canAddAppendBranchFlowBranch = true\n  let canAddSubFlow = true\n  let canAddAppendLaunchFlow = true\n  let canAddTimerNode = true\n  if (Array.isArray(data.conditionNodes) && data.conditionNodes.length) {\n    canAddAppendBranch = false\n    canAddAppendInterflow = false\n    canAddAppendBranchFlowBranch = false\n    canAddSubFlow = false\n    canAddTimerNode = false\n    canAddAppendLaunchFlow = false\n  }\n  if (data.type === 'timer' || (data.childNode && data.childNode.type === 'timer')) {\n    canAddTimerNode = false\n  }\n  if (data.type === 'subFlow') {\n    canAddAppendBranch = false\n  }\n  if (data && data.childNode && data.childNode.type === 'getData') {\n    return <div class=\"add-node-btn-box flex justify-center\"></div>;\n  }\n  let isEmpty = data.type === \"empty\";\n  if (isEmpty && !isBranch) {\n    return \"\";\n  }\n  return (\n    <div class=\"add-node-btn-box flex justify-center\">\n      <div class=\"add-node-btn\">\n        <el-popover placement=\"right\" trigger=\"click\" width=\"440\">\n          <div class=\"condition-box\">\n            <div>\n              <div class=\"condition-icon\" onClick={ctx.eventLauncher.bind(ctx, \"addAddDataNode\", data, isBranch)} >\n                <i class=\"icon-ym icon-ym-btn-add\"></i>\n              </div>\n              新增数据\n            </div>\n            <div class={{ 'condition-disabled': !canAddSubFlow && !isBranch }}>\n              <div class=\"condition-icon\" onClick={ctx.eventLauncher.bind(ctx, \"addUpdateDataNode\", data, isBranch, !canAddSubFlow && !isBranch)} >\n                <i class=\"icon-ym icon-ym-Refresh\"></i>\n              </div>\n              更新数据\n            </div>\n            <div class={{ 'condition-disabled': !canAddAppendBranch }}>\n              <div class=\"condition-icon\" onClick={this.eventLauncher.bind(ctx, \"addDeleteDataNode\", data, isBranch, !canAddAppendBranch)}>\n                <i class=\"icon-ym icon-ym-delete\"></i>\n              </div>\n              删除数据\n            </div>\n            <div class={{ 'condition-disabled': !canAddAppendBranchFlowBranch }}>\n              <div class=\"condition-icon\" onClick={this.eventLauncher.bind(ctx, \"addDataInterfaceNode\", data, isBranch, !canAddAppendBranchFlowBranch)}>\n                <i class=\"icon-ym icon-ym-options\"></i>\n              </div>\n              数据接口\n            </div>\n            <div class={{ 'condition-disabled': !canAddAppendInterflow }}>\n              <div class=\"condition-icon\" onClick={this.eventLauncher.bind(ctx, \"addMessageNode\", data, isBranch, !canAddAppendInterflow)}>\n                <i class=\"icon-ym icon-ym-xitong\"></i>\n              </div>\n              消息通知\n            </div>\n            <div class={{ 'condition-disabled': !canAddAppendLaunchFlow }}>\n              <div class=\"condition-icon\" onClick={this.eventLauncher.bind(ctx, \"addLaunchFlowNode\", data, isBranch, !canAddAppendLaunchFlow)}>\n                <i class=\"icon-ym icon-ym-launch\"></i>\n              </div>\n              发起审批\n            </div>\n          </div>\n          <button class=\"btn\" type=\"button\" slot=\"reference\">\n            <i class=\"el-icon-plus icon\"></i>\n          </button>\n        </el-popover>\n      </div>\n    </div>\n  );\n}\n\nfunction NodeFactory(ctx, data, h) {\n  if (!data) return;\n  const showErrorTip = ctx.verifyMode && NodeUtils.checkNode(data) === false;\n  let content = '请完善配置';\n  let res = [],\n    branchNode = \"\",\n    selfNode = (\n      <div class=\"node-wrap\">\n        <div class={`node-wrap-box ${data.type} ${NodeUtils.isInterflowNode(data) ? 'interflow' : ''}\n                ${NodeUtils.isBranchFlowNode(data) ? 'branchFlow' : ''} ${showErrorTip ? 'error' : ''}`}>\n          <el-tooltip content={content} placement=\"top\" effect=\"dark\">\n            <div class=\"error-tip\" onClick={this.eventLauncher.bind(ctx, \"edit\", data)}>!!!</div>\n          </el-tooltip>\n          {nodes[data.type].call(ctx, ctx, data, h)}\n          {addNodeButton.call(ctx, ctx, data, h)}\n        </div>\n      </div>\n    );\n\n  if (hasBranch(data)) {\n    // 如果节点是数组 一定为条件分支 添加分支样式包裹\n    branchNode = (\n      <div class=\"branch-wrap\">\n        <div class=\"branch-box-wrap\">\n          <div class=\"branch-box flex justify-center relative\">\n            {addBranchButton(data)}\n            {data.conditionNodes.map(d => NodeFactory.call(ctx, ctx, d, h))}\n          </div>\n        </div>\n        {addNodeButton.call(ctx, data, h, true)}\n      </div>\n    );\n  }\n  if (isCondition(data)) {\n    return (\n      <div class=\"col-box\">\n        <div class=\"center-line\"></div>\n        <div class=\"top-cover-line\"></div>\n        <div class=\"bottom-cover-line\"></div>\n        {selfNode}\n        {branchNode}\n        {NodeFactory.call(ctx, ctx, data.childNode, h)}\n      </div>\n    );\n  }\n  res.push(selfNode);\n  branchNode && res.push(branchNode);\n  data.childNode && res.push(NodeFactory.call(ctx, ctx, data.childNode, h));\n  return res;\n}\n\nfunction addEndNode(h) {\n  return <section class=\"end-node\">流程结束</section>;\n}\n\nexport default {\n  props: {\n    data: { type: Object, required: true },\n    // 点击发布时需要校验节点数据完整性 此时打开校验模式\n    verifyMode: { type: Boolean, default: true },\n  },\n  watch: {\n\n  },\n  methods: {\n    /**\n     *事件触发器 统筹本组件所有事件并转发到父组件中\n     * @param { Object } 包含event（事件名）和args（事件参数）两个参数\n     */\n    eventLauncher(event, ...args) {\n      stopPro(args[args.length - 1])\n      let list = ['appendBranch', 'appendBranchFlowBranch', 'appendInterflowBranch', 'addTimerNode']\n      if (list.includes(event) && args[args.length - 2]) return\n      // args.slice(0,-1) vue 会注入MouseEvent到最后一个参数 去除事件对象\n      let param = { event, args: args.slice(0, -1) };\n      this.$emit(\"emits\", param);\n    }\n  },\n  render(h) {\n    return (\n      <div style=\"display: inline-flex; flex-direction: column; align-items: center;\">\n        {this.data && NodeFactory.call(this, this, this.data, h)}\n        {addEndNode(h)}\n      </div>\n    );\n  }\n};\n",null]}