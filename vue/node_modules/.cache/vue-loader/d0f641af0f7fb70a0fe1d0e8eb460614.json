{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/extend/email/Form.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/extend/email/Form.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { SaveSent, EmailInfo, SaveDraft } from '@/api/extend/email'\nexport default {\n  data() {\n    return {\n      visible: false,\n      sendLoading: false,\n      saveLoading: false,\n      dataForm: {\n        recipient: [],\n        cc: [],\n        bcc: [],\n        subject: '',\n        bodyText: '',\n        id: '',\n        attachment: \"\"\n      },\n      showCC: false,\n      showBCC: false,\n      dataRule: {\n        recipient: [\n          { type: 'array', required: true, message: '收件人不能为空', trigger: 'blur' },\n        ],\n        cc: [\n          { type: 'array', required: true, message: '抄送人不能为空', trigger: 'blur' },\n        ],\n        bcc: [\n          { type: 'array', required: true, message: '密送人不能为空', trigger: 'blur' }\n        ],\n        subject: [\n          { required: true, message: '主题不能为空', trigger: 'blur' }\n        ],\n      },\n      fileList: []\n    }\n  },\n  created() { },\n  methods: {\n    goBack() {\n      this.$emit('close')\n    },\n    init(id) {\n      this.dataForm.id = ''\n      this.$nextTick(() => {\n        this.fileList = []\n        this.$refs['dataForm'].resetFields()\n        if (id) {\n          EmailInfo(id).then(res => {\n            this.dataForm = {\n              recipient: res.data.recipient ? res.data.recipient.split(',') : [],\n              cc: res.data.cc ? res.data.cc.split(',') : [],\n              bcc: res.data.bcc ? res.data.bcc.split(',') : [],\n              subject: res.data.subject,\n              bodyText: res.data.bodyText,\n              id: res.data.id\n            }\n            this.showCC = !!this.dataForm.cc.length\n            this.showBCC = !!this.dataForm.bcc.length\n            this.fileList = JSON.parse(res.data.attachment)\n          })\n        }\n      })\n    },\n    dataFormSubmit(isSend) {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          isSend ? (this.sendLoading = true) : (this.saveLoading = true)\n          let data = {\n            recipient: this.dataForm.recipient.join(','),\n            subject: this.dataForm.subject,\n            bodyText: this.dataForm.bodyText,\n            attachment: JSON.stringify(this.fileList)\n          }\n          if (this.showCC) data = { ...data, cc: this.dataForm.cc.join(',') }\n          if (this.showBCC) data = { ...data, bcc: this.dataForm.bcc.join(',') }\n          if (this.dataForm.id) data = { ...data, id: this.dataForm.id }\n          const formMethod = isSend ? SaveSent : SaveDraft\n          formMethod(data).then(res => {\n            this.$message({\n              message: res.msg,\n              type: 'success',\n              duration: 1500,\n              onClose: () => {\n                isSend ? (this.sendLoading = false) : (this.saveLoading = false)\n                this.$emit('refresh', isSend)\n              }\n            })\n          }).catch(() => { isSend ? (this.sendLoading = false) : (this.saveLoading = false) })\n        }\n      })\n    },\n  }\n}\n",null]}