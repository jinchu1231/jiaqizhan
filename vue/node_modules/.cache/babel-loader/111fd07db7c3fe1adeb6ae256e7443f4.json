{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/Jnpf/Calculate/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/Jnpf/Calculate/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _typeof2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/typeof.js\"));\nrequire(\"core-js/modules/es6.number.constructor\");\nrequire(\"core-js/modules/es6.regexp.split\");\nvar _slicedToArray2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/slicedToArray.js\"));\nvar _index = require(\"@/components/Generator/utils/index\");\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = exports.default = {\n  model: {\n    prop: 'value',\n    event: 'input'\n  },\n  props: [\"value\", \"formData\", \"expression\", \"tableVModel\", \"componentVModel\", 'isStorage', \"rowIndex\",\n  // 计算公式放在表格中时， 需要获取在表格中的行位置\n  \"detailed\", \"isAmountChinese\", \"thousands\", 'precision'],\n  name: 'JnpfCalculate',\n  data: function data() {\n    return {\n      innerValue: this.value,\n      RPN_EXP: (0, _index.toRPN)((0, _index.mergeNumberOfExps)(this.expression)),\n      setValue: 0,\n      amountChineseName: ''\n    };\n  },\n  computed: {\n    rootFormData: function rootFormData() {\n      return this.formData || this.getFormData();\n    }\n  },\n  methods: {\n    getFormData: function getFormData() {\n      var root = this.$parent;\n      while (root) {\n        if ('vmFormData' in root) {\n          return root.vmFormData;\n        }\n        root = root.$parent;\n      }\n    },\n    /**\n     * 获取指定组件的值\n     */\n    getFormVal: function getFormVal(vModel) {\n      try {\n        if (vModel.indexOf('.') > -1) {\n          var _vModel$split = vModel.split('.'),\n            _vModel$split2 = (0, _slicedToArray2.default)(_vModel$split, 2),\n            tableVModel = _vModel$split2[0],\n            cmpVModel = _vModel$split2[1];\n          if (typeof this.rowIndex === 'number') {\n            return this.rootFormData[tableVModel][this.rowIndex][cmpVModel] || 0;\n          } else {\n            return this.rootFormData[tableVModel].reduce(function (sum, c) {\n              return (c[cmpVModel] ? Number(c[cmpVModel]) : 0) + sum;\n            }, 0);\n          }\n        }\n        return this.rootFormData[vModel] || 0;\n      } catch (error) {\n        console.warn('计算公式出错, 可能包含无效的组件值', error);\n        return 0;\n      }\n    },\n    /**\n     * 计算表达式\n     */\n    execRPN: function execRPN() {\n      var _this = this;\n      var temp = this.RPN_EXP.map(function (t) {\n        return (0, _typeof2.default)(t) === 'object' ? _this.getFormVal(t.__vModel__) : t;\n      });\n      this.innerValue = parseFloat(parseFloat((0, _index.calcRPN)(temp)).toFixed(this.precision || 0));\n      this.setValue = JSON.parse(JSON.stringify(this.innerValue));\n      if (isNaN(this.innerValue)) this.innerValue = 0;\n      if (isNaN(this.setValue)) this.setValue = 0;\n      this.$emit('input', this.setValue);\n      if (this.rowIndex >= 0 && this.componentVModel && this.tableVModel) {\n        if (this.rootFormData[this.tableVModel][this.rowIndex][this.componentVModel] !== this.innerValue) {\n          this.$emit('change', this.setValue);\n        }\n      }\n      if (this.thousands) {\n        this.innerValue = (0, _index.thousandsFormat)(this.innerValue);\n      }\n      if (this.isAmountChinese) this.amountChineseName = (0, _index.getAmountChinese)(this.setValue || 0);\n    }\n  },\n  watch: {\n    formData: {\n      handler: function handler(val) {\n        if (!val) return;\n        if (!this.computeExps) {\n          // formData更新可能比较频繁\n          this.computeExps = (0, _index.debounce)(this.execRPN, 100);\n        }\n        this.computeExps();\n      },\n      deep: true,\n      immediate: true\n    }\n  }\n};",null]}