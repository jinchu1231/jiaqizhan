{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/JNPFCustom/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/JNPFCustom/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es7.array.includes\");\nrequire(\"core-js/modules/es6.string.includes\");\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _Parser = _interopRequireDefault(require(\"@/components/Generator/parser/Parser\"));\nvar _visualDev = require(\"@/api/onlineDev/visualDev\");\nvar _dataInterface = require(\"@/api/systemData/dataInterface\");\nvar _vuex = require(\"vuex\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } //\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = exports.default = {\n  name: 'popup',\n  components: {\n    Parser: _Parser.default\n  },\n  props: {},\n  data: function data() {\n    return {\n      visible: false,\n      btnLoading: false,\n      loading: false,\n      config: {},\n      formConf: {},\n      formData: {},\n      isPreview: false,\n      key: +new Date(),\n      id: \"\",\n      dataForm: {\n        id: \"\",\n        data: \"\"\n      },\n      modelId: \"\",\n      isAdd: false\n    };\n  },\n  computed: _objectSpread({}, (0, _vuex.mapGetters)(['userInfo'])),\n  methods: {\n    init: function init(config, modelId, id) {\n      var _this = this;\n      var isPreview = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : true;\n      var row = arguments.length > 4 ? arguments[4] : undefined;\n      this.loading = true;\n      this.config = config;\n      this.id = id;\n      this.isPreview = isPreview;\n      this.modelId = modelId;\n      this.isAdd = true;\n      this.$nextTick(function () {\n        if (_this.config.modelId) _this.getConfigData(row);\n      });\n    },\n    getConfigData: function getConfigData(row) {\n      var _this2 = this;\n      (0, _visualDev.getConfigData)(this.config.modelId).then(function (res) {\n        if (res.code !== 200 || !res.data) {\n          _this2.$message({\n            message: res.msg || '请求出错，请重试',\n            type: 'error',\n            duration: 1500\n          });\n          return;\n        }\n        _this2.formConf = JSON.parse(res.data.formData);\n        var setDataFun = function setDataFun(formData) {\n          if (_this2.config.formOptions.length) {\n            for (var k in formData) {\n              for (var i = 0; i < _this2.config.formOptions.length; i++) {\n                var e = _this2.config.formOptions[i];\n                if (e.currentField == '@formId') _this2.formData[e.field] = formData.id;\n                if (e.currentField == k) _this2.formData[e.field] = formData[k];\n              }\n            }\n          }\n          _this2.fillFormData(_this2.formConf, _this2.formData);\n          _this2.$nextTick(function () {\n            _this2.visible = true;\n            _this2.loading = false;\n          });\n        };\n        if (_this2.id) {\n          (0, _visualDev.getModelInfo)(_this2.modelId, _this2.id).then(function (res) {\n            var dataForm = res.data;\n            if (!dataForm.data) return;\n            var formData = JSON.parse(dataForm.data);\n            _this2.formData = {};\n            setDataFun(_objectSpread(_objectSpread({}, formData), {}, {\n              id: _this2.id\n            }));\n          });\n        } else {\n          var formData = row;\n          setDataFun(formData);\n        }\n      }).catch(function () {});\n    },\n    fillFormData: function fillFormData(form, data) {\n      var _this3 = this;\n      var loop = function loop(list, parent) {\n        var _loop = function _loop() {\n          var item = list[i];\n          if (item.__vModel__) {\n            var val = data.hasOwnProperty(item.__vModel__) ? data[item.__vModel__] : item.__config__.defaultValue;\n            if (!item.__config__.isSubTable) item.__config__.defaultValue = val;\n            if (_this3.isAdd || item.__config__.isSubTable) {\n              //新增时候，默认当前\n              if (item.__config__.defaultCurrent) {\n                if (item.__config__.jnpfKey === 'datePicker') {\n                  var format = item.format;\n                  var dateStr = _this3.jnpf.toDate(new Date().getTime(), format);\n                  var time = format === 'yyyy' ? '-01-01 00:00:00' : format === 'yyyy-MM' ? '-01 00:00:00' : format === 'yyyy-MM-dd' ? ' 00:00:00' : '';\n                  item.__config__.defaultValue = new Date(dateStr + time).getTime();\n                }\n                if (item.__config__.jnpfKey === 'timePicker') {\n                  item.__config__.defaultValue = _this3.jnpf.toDate(new Date(), item.format);\n                }\n                if (item.__config__.jnpfKey === 'organizeSelect' && _this3.userInfo.organizeIdList instanceof Array && _this3.userInfo.organizeIdList.length > 0) {\n                  item.__config__.defaultValue = item.multiple == true ? [_this3.userInfo.organizeIdList] : _this3.userInfo.organizeIdList;\n                }\n                if (item.__config__.jnpfKey === 'depSelect' && _this3.userInfo.departmentId) {\n                  item.__config__.defaultValue = item.multiple ? [_this3.userInfo.departmentId] : _this3.userInfo.departmentId;\n                }\n                if (item.__config__.jnpfKey === 'posSelect' && _this3.userInfo.positionIds instanceof Array && _this3.userInfo.positionIds.length > 0) {\n                  item.__config__.defaultValue = item.multiple ? _this3.userInfo.positionIds.map(function (o) {\n                    return o.id;\n                  }) : _this3.userInfo.positionIds[0].id;\n                }\n                if (item.__config__.jnpfKey === 'roleSelect' && _this3.userInfo.roleIds instanceof Array && _this3.userInfo.roleIds.length > 0) {\n                  item.__config__.defaultValue = item.multiple ? _this3.userInfo.roleIds : _this3.userInfo.roleIds[0];\n                }\n                if (item.__config__.jnpfKey === 'groupSelect' && _this3.userInfo.groupIds instanceof Array && _this3.userInfo.groupIds.length > 0) {\n                  item.__config__.defaultValue = item.multiple ? _this3.userInfo.groupIds : _this3.userInfo.groupIds[0];\n                }\n                if (['userSelect'].includes(item.__config__.jnpfKey) && _this3.userInfo.userId) {\n                  item.__config__.defaultValue = item.multiple ? [_this3.userInfo.userId] : _this3.userInfo.userId;\n                }\n                if (item.__config__.jnpfKey === 'usersSelect' && _this3.userInfo.userId) {\n                  item.__config__.defaultValue = item.multiple ? [_this3.userInfo.userId + '--user'] : _this3.userInfo.userId + '--user';\n                }\n                if (item.__config__.jnpfKey == 'sign' && _this3.userInfo.signImg) item.__config__.defaultValue = _this3.userInfo.signImg;\n              }\n            }\n          }\n          if (!_this3.isPreview && _this3.useFormPermission) {\n            var id = item.__config__.isSubTable ? parent.__vModel__ + '-' + item.__vModel__ : item.__vModel__;\n            var noShow = true;\n            if (_this3.formOperates && _this3.formOperates.length) {\n              noShow = !_this3.formOperates.some(function (o) {\n                return o.enCode === id;\n              });\n            }\n            noShow = item.__config__.noShow ? item.__config__.noShow : noShow;\n            _this3.$set(item.__config__, 'noShow', noShow);\n          }\n          if (item.__config__ && item.__config__.children && Array.isArray(item.__config__.children)) {\n            loop(item.__config__.children, item);\n          }\n        };\n        for (var i = 0; i < list.length; i++) {\n          _loop();\n        }\n      };\n      loop(form.fields);\n      form.formData = data;\n    },\n    submitForm: function submitForm(data, callback) {\n      var _this4 = this;\n      console.log(data);\n      if (!data) return;\n      this.btnLoading = true;\n      var successFun = function successFun(res, callback) {\n        _this4.$message({\n          message: res.msg,\n          type: 'success',\n          duration: 1500,\n          onClose: function onClose() {\n            if (callback && typeof callback === \"function\") callback();\n            _this4.visible = false;\n            _this4.btnLoading = false;\n          }\n        });\n      };\n      if (this.config.customBtn) {\n        if (this.config.templateJson && this.config.templateJson.length) {\n          this.config.templateJson.forEach(function (ele) {\n            var value = data[ele.relationField] || data[ele.relationField] == 0 || data[ele.relationField] == false ? data[ele.relationField] : '';\n            ele.defaultValue = ele.relationField === '@formId' && ele.sourceType == 1 ? data.id : ele.sourceType == 1 ? value : ele.relationField;\n          });\n        }\n        var query = {\n          paramList: this.config.templateJson || []\n        };\n        (0, _dataInterface.getDataInterfaceRes)(this.config.interfaceId, query).then(function (res) {\n          successFun(res, callback);\n        }).catch(function () {\n          _this4.btnLoading = false;\n        });\n      } else {\n        var formData = _objectSpread(_objectSpread({}, this.formData), data);\n        this.dataForm.data = JSON.stringify(formData);\n        (0, _visualDev.createModel)(this.config.modelId, this.dataForm).then(function (res) {\n          successFun(res, callback);\n        }).catch(function () {\n          _this4.btnLoading = false;\n        });\n      }\n    },\n    dataFormSubmit: function dataFormSubmit() {\n      if (this.isPreview) return this.$message({\n        message: '功能预览不支持数据保存',\n        type: 'warning'\n      });\n      this.$refs.dynamicForm && this.$refs.dynamicForm.submitForm();\n    }\n  }\n};",null]}