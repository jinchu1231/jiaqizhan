{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/onlineDev/webDesign/ShortLinkDialog.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/onlineDev/webDesign/ShortLinkDialog.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nrequire(\"core-js/modules/es6.string.includes\");\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es7.array.includes\");\nvar _qrcodejs = _interopRequireDefault(require(\"qrcodejs2\"));\nvar _clipboard = _interopRequireDefault(require(\"@/utils/clipboard\"));\nvar _webDesign = require(\"@/api/onlineDev/webDesign\");\nvar _visualDev = require(\"@/api/onlineDev/visualDev\");\nvar _ChangeField = _interopRequireDefault(require(\"@/components/ChangeField\"));\nvar _comConfig = require(\"@/components/Generator/generator/comConfig\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } //\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar getFormDataFields = function getFormDataFields(item) {\n  var jnpfKey = item.__config__.jnpfKey;\n  var fieldsList = ['input', 'textarea', 'inputNumber', 'switch', 'datePicker', 'timePicker', 'colorPicker', 'rate', 'slider', 'editor', 'link', 'text', 'alert', 'table', 'collapse', 'collapseItem', 'tabItem', 'tab', 'row', 'card', 'groupTitle', 'divider', 'tableGrid', 'tableGridTr', 'tableGridTd', 'sign', 'location'];\n  var fieldsSelectList = [\"radio\", \"checkbox\", \"select\", \"cascader\", \"treeSelect\"];\n  if (fieldsList.includes(jnpfKey) || fieldsSelectList.includes(jnpfKey) && item.__config__.dataType === 'static') return item;\n};\nvar _default = exports.default = {\n  components: {\n    ChangeField: _ChangeField.default\n  },\n  data: function data() {\n    return {\n      previewAppVisible: false,\n      changeFieldVisible: false,\n      qrCodeText: '',\n      dialogVisible: false,\n      loading: false,\n      btnLoading: false,\n      visible: false,\n      dataForm: {\n        id: '',\n        formLink: '',\n        formUse: 0,\n        formPassUse: 0,\n        formPassword: '',\n        columnUse: 0,\n        columnLink: '',\n        columnPassUse: 0,\n        columnPassword: '',\n        columnCondition: [],\n        columnText: [],\n        alreadySave: false\n      },\n      columnCondition: [],\n      columnText: [],\n      dataRule: {\n        formPassword: [{\n          required: true,\n          message: '请输入',\n          trigger: 'blur'\n        }, {\n          pattern: /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^(0-9a-zA-Z)]).{6,16}$/,\n          message: '密码必须由数字、字母、特殊字符组合,请输入6-16位',\n          trigger: 'blur'\n        }],\n        columnPassword: [{\n          required: true,\n          message: '请输入',\n          trigger: 'blur'\n        }, {\n          pattern: /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^(0-9a-zA-Z)]).{6,16}$/,\n          message: '密码必须由数字、字母、特殊字符组合,请输入6-16位',\n          trigger: 'blur'\n        }]\n      },\n      qrcode: '',\n      formData: '',\n      listOptions: [],\n      searchList: [],\n      webType: '1',\n      type: ''\n    };\n  },\n  methods: {\n    download: function download(type) {\n      var qrcode = '';\n      if (type == 1) {\n        qrcode = document.querySelector('#qrcode');\n      } else {\n        qrcode = document.querySelector('#qrcode2');\n      }\n      var canvas = qrcode.querySelector('canvas');\n      var imgurl = canvas.toDataURL('image/png');\n      var a = document.createElement('a');\n      a.href = imgurl;\n      a.download = '二维码'; // 图片名称\n      a.click();\n    },\n    columnConditionChange: function columnConditionChange(arr) {\n      var _this = this;\n      var list = [];\n      var _loop = function _loop() {\n        var element = _this.searchList[index];\n        arr.forEach(function (o) {\n          if (element.id == o) {\n            list.push(element);\n          }\n        });\n      };\n      for (var index = 0; index < this.searchList.length; index++) {\n        _loop();\n      }\n      this.dataForm.columnCondition = list;\n    },\n    columnTextChange: function columnTextChange(arr) {\n      var _this2 = this;\n      var list = [];\n      var _loop2 = function _loop2() {\n        var element = _this2.listOptions[index];\n        arr.forEach(function (o) {\n          if (element.id == o) {\n            list.push(element);\n          }\n        });\n      };\n      for (var index = 0; index < this.listOptions.length; index++) {\n        _loop2();\n      }\n      this.dataForm.columnText = list;\n    },\n    init: function init(id) {\n      var _this3 = this;\n      this.btnLoading = false;\n      this.webType = '1';\n      this.columnCondition = '';\n      this.columnText = '';\n      this.getShortLink(id);\n      (0, _visualDev.getVisualDevInfo)(id).then(function (res) {\n        _this3.webType = res.data.webType || '1';\n        _this3.formData = res.data.formData && JSON.parse(res.data.formData);\n        var list = [];\n        if (_this3.formData && _this3.formData.fields.length) {\n          var loop = function loop(data, parent) {\n            if (!data) return;\n            if (data.__config__ && data.__config__.children && Array.isArray(data.__config__.children)) {\n              loop(data.__config__.children, data);\n            }\n            if (Array.isArray(data)) data.forEach(function (d) {\n              return loop(d, parent);\n            });\n            if (data.__config__ && data.__config__.jnpfKey) {\n              var visibility = !data.__config__.visibility || Array.isArray(data.__config__.visibility) && data.__config__.visibility.includes('pc');\n              if (data.__config__.layout === 'colFormItem' && data.__vModel__ && visibility) {\n                var isTableChild = parent && parent.__config__ && parent.__config__.jnpfKey === 'table';\n                list.push(_objectSpread(_objectSpread({\n                  id: isTableChild ? parent.__vModel__ + '-' + data.__vModel__ : data.__vModel__,\n                  fullName: isTableChild ? parent.__config__.label + '-' + data.__config__.label : data.__config__.label\n                }, data), {}, {\n                  disabled: false\n                }));\n              }\n            }\n          };\n          loop(_this3.formData.fields);\n        }\n        _this3.listOptions = list;\n        _this3.listOptions = list.filter(function (o) {\n          return _comConfig.noColumnShowList.indexOf(o.__config__.jnpfKey) < 0 || o.isStorage == 1;\n        });\n        _this3.searchList = list.filter(function (o) {\n          return _comConfig.noSearchList.indexOf(o.__config__.jnpfKey) < 0;\n        });\n        _this3.listOptions = _this3.listOptions.filter(function (o) {\n          return getFormDataFields(o);\n        });\n        _this3.searchList = _this3.searchList.filter(function (o) {\n          return getFormDataFields(o);\n        });\n        _this3.searchList = _this3.searchList.map(function (o) {\n          return _objectSpread({\n            label: o.fullName,\n            prop: o.id,\n            jnpfKey: o.__config__.jnpfKey,\n            value: ''\n          }, o);\n        });\n        _this3.listOptions = _this3.listOptions.map(function (o) {\n          return _objectSpread({\n            label: o.fullName,\n            prop: o.id,\n            fixed: 'none',\n            align: 'left',\n            jnpfKey: o.__config__.jnpfKey,\n            sortable: false,\n            width: null\n          }, o);\n        });\n      });\n      this.dialogVisible = true;\n    },\n    getShortLink: function getShortLink(id) {\n      var _this4 = this;\n      (0, _webDesign.getShortLink)(id).then(function (res) {\n        _this4.dataForm = res.data || {};\n        _this4.dataForm.columnCondition = _this4.dataForm.columnCondition ? JSON.parse(_this4.dataForm.columnCondition) : [];\n        _this4.dataForm.columnText = _this4.dataForm.columnText ? JSON.parse(_this4.dataForm.columnText) : [];\n        var column = [];\n        if (_this4.dataForm.columnCondition.length) {\n          _this4.dataForm.columnCondition.forEach(function (o) {\n            column.push(o.id);\n          });\n        }\n        _this4.columnCondition = column;\n        var text = [];\n        if (_this4.dataForm.columnText.length) {\n          _this4.dataForm.columnText.forEach(function (o) {\n            text.push(o.id);\n          });\n        }\n        _this4.columnText = text;\n      });\n    },\n    change: function change(type) {\n      var _this5 = this;\n      this.type = type;\n      this.changeFieldVisible = true;\n      this.$nextTick(function () {\n        _this5.$refs.ChangeField.openDialog();\n      });\n    },\n    copy: function copy(text, event) {\n      (0, _clipboard.default)(text, event);\n    },\n    open: function open(val) {\n      window.open(val);\n    },\n    getQRimg: function getQRimg() {\n      if (!this.dataForm.formLink || !this.dataForm.alreadySave) {\n        return;\n      }\n      this.$refs.qrCode.innerHTML = \"\";\n      this.qrcode = new _qrcodejs.default(this.$refs.qrCode, {\n        width: 150,\n        height: 150,\n        // 高度\n        text: this.dataForm.formLink,\n        // 二维码内容\n        // render: 'canvas' // 设置渲染方式（有两种方式 table和canvas，默认是canvas）\n        // background: '#f0f'\n        // foreground: '#ff0'\n        correctLevel: _qrcodejs.default.CorrectLevel.H //容错级别 容错级别有：（1）QRCode.CorrectLevel.L （2）QRCode.CorrectLevel.M （3）QRCode.CorrectLevel.Q （4）QRCode.CorrectLevel.H\n      });\n    },\n    getQRimg2: function getQRimg2() {\n      if (!this.dataForm.columnLink || !this.dataForm.alreadySave) {\n        return;\n      }\n      this.$refs.qrCode2.innerHTML = \"\";\n      this.qrcode = new _qrcodejs.default(this.$refs.qrCode2, {\n        width: 150,\n        height: 150,\n        // 高度\n        text: this.dataForm.columnLink,\n        // 二维码内容\n        // render: 'canvas' // 设置渲染方式（有两种方式 table和canvas，默认是canvas）\n        // background: '#f0f'\n        // foreground: '#ff0'\n        correctLevel: _qrcodejs.default.CorrectLevel.H //容错级别 容错级别有：（1）QRCode.CorrectLevel.L （2）QRCode.CorrectLevel.M （3）QRCode.CorrectLevel.Q （4）QRCode.CorrectLevel.H\n      });\n    },\n    dataFormSubmit: function dataFormSubmit() {\n      var _this6 = this;\n      if (this.dataForm.formPassUse == 0) this.dataForm.formPassword = '';\n      if (this.dataForm.columnPassUse == 0) this.dataForm.columnPassword = '';\n      if (this.dataForm.formPassUse == 1 && !this.dataForm.formPassword) return this.$message.error('请输入表单凭密码填写');\n      if (this.dataForm.columnPassUse == 1 && !this.dataForm.columnPassword) return this.$message.error('请输入列表凭密码填写');\n      this.btnLoading = true;\n      if (typeof this.dataForm.columnCondition !== 'string') this.dataForm.columnCondition = JSON.stringify(this.dataForm.columnCondition);\n      if (typeof this.dataForm.columnText !== 'string') this.dataForm.columnText = JSON.stringify(this.dataForm.columnText);\n      this.$refs['dataForm'].validate(function (valid) {\n        if (valid) {\n          (0, _webDesign.save)(_this6.dataForm).then(function (res) {\n            _this6.$message({\n              type: 'success',\n              message: res.msg,\n              duration: 1000,\n              onClose: function onClose() {\n                _this6.$nextTick(function () {\n                  _this6.btnLoading = false;\n                  _this6.getShortLink(_this6.dataForm.id);\n                });\n              }\n            });\n          });\n        } else {\n          _this6.btnLoading = false;\n        }\n      });\n    }\n  }\n};",null]}