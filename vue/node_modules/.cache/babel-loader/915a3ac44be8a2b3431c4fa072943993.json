{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/formShortLink/form/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/formShortLink/form/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es7.array.includes\");\nvar _Parser = _interopRequireDefault(require(\"@/components/Generator/parser/Parser\"));\nvar _FlowBox = _interopRequireDefault(require(\"@/views/workFlow/components/FlowBox\"));\nvar _FlowEngine = require(\"@/api/workFlow/FlowEngine\");\nvar _webDesign = require(\"@/api/onlineDev/webDesign\");\nvar _qrcodejs = _interopRequireDefault(require(\"qrcodejs2\"));\nvar _jsMd = _interopRequireDefault(require(\"js-md5\"));\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nvar getFormDataFields = function getFormDataFields(item) {\n  if (!item.__config__ || !item.__config__.jnpfKey) return true;\n  var jnpfKey = item.__config__.jnpfKey;\n  var list = ['input', 'textarea', 'inputNumber', 'switch', 'datePicker', 'timePicker', 'colorPicker', 'rate', 'slider', 'editor', 'link', 'text', 'alert', 'table', 'collapse', 'collapseItem', 'tabItem', 'tab', 'row', 'card', 'groupTitle', 'divider', 'tableGrid', 'tableGridTr', 'tableGridTd', 'sign', 'rate', 'slider', 'iframe', 'location'];\n  var fieldsSelectList = [\"radio\", \"checkbox\", \"select\", \"cascader\", \"treeSelect\"];\n  if (list.includes(jnpfKey) || fieldsSelectList.includes(jnpfKey) && item.__config__.dataType === 'static') return true;\n  return false;\n};\nvar _default = exports.default = {\n  components: {\n    Parser: _Parser.default,\n    FlowBox: _FlowBox.default\n  },\n  props: ['config', 'modelId', 'isPreview', 'encryption'],\n  data: function data() {\n    return {\n      visible: false,\n      dataForm: {\n        data: ''\n      },\n      btnLoading: false,\n      loading: true,\n      key: +new Date(),\n      formConf: {},\n      flowVisible: false,\n      flowListVisible: false,\n      flowList: [],\n      flowItem: {},\n      formLink: '',\n      formPassUse: 1,\n      password: '',\n      passwordLoading: false,\n      id: ''\n    };\n  },\n  created: function created() {\n    var _this = this;\n    (0, _webDesign.getConfig)(this.modelId, this.encryption).then(function (res) {\n      _this.formLink = res.data.formLink || '';\n      _this.id = res.data.id || 0;\n      _this.formPassUse = res.data.formPassUse || 0;\n      if (_this.formPassUse == 1) return;\n      _this.init();\n    });\n  },\n  methods: {\n    init: function init(flag) {\n      var _this2 = this;\n      if (this.config.enableFlow) {\n        this.getFlowList(flag);\n      } else {\n        this.formConf = JSON.parse(this.config.formData);\n        this.formConf.fields = this.recurSiveFilter(this.formConf.fields);\n        this.fillFormData(this.formConf, {});\n        this.loading = true;\n        this.$nextTick(function () {\n          _this2.visible = true;\n          _this2.loading = false;\n          _this2.key = +new Date();\n        });\n      }\n    },\n    fillFormData: function fillFormData(form, data, flag) {\n      var _this3 = this;\n      var loop = function loop(list, parent) {\n        for (var i = 0; i < list.length; i++) {\n          var item = list[i];\n          if (item.__vModel__) {\n            if (item.__config__.defaultCurrent) {\n              if (item.__config__.jnpfKey === 'datePicker') {\n                var format = item.format;\n                var dateStr = _this3.jnpf.toDate(new Date().getTime(), format);\n                var time = format === 'yyyy' ? '-01-01 00:00:00' : format === 'yyyy-MM' ? '-01 00:00:00' : format === 'yyyy-MM-dd' ? ' 00:00:00' : '';\n                item.__config__.defaultValue = new Date(dateStr + time).getTime();\n              }\n              if (item.__config__.jnpfKey === 'timePicker') {\n                item.__config__.defaultValue = _this3.jnpf.toDate(new Date(), item.format);\n              }\n            }\n          }\n          if (item.__config__ && item.__config__.children && Array.isArray(item.__config__.children)) {\n            loop(item.__config__.children, item);\n          }\n        }\n      };\n      loop(form.fields);\n      form.formData = data;\n    },\n    getFlowList: function getFlowList(flag) {\n      var _this4 = this;\n      (0, _FlowEngine.getFlowList)(this.config.flowId, '1').then(function (res) {\n        _this4.flowList = res.data;\n        if (flag && _this4.flowItem.id) return _this4.selectFlow(_this4.flowItem);\n        if (!_this4.flowList.length) return _this4.$message({\n          type: 'error',\n          message: '流程不存在'\n        });\n        if (_this4.flowList.length === 1) return _this4.selectFlow(_this4.flowList[0]);\n        _this4.flowListVisible = true;\n      });\n    },\n    handleLogin: function handleLogin() {\n      var _this5 = this;\n      this.passwordLoading = true;\n      if (!this.password) {\n        this.$message({\n          message: '请输入验证码',\n          type: 'error'\n        });\n        this.passwordLoading = false;\n        return;\n      }\n      var param = {\n        id: this.id,\n        type: 0,\n        encryption: this.encryption,\n        password: (0, _jsMd.default)(this.password)\n      };\n      (0, _webDesign.checkPwd)(param).then(function (res) {\n        _this5.passwordLoading = false;\n        if (res.code == 200) {\n          _this5.formPassUse = 0;\n          _this5.init();\n        }\n      }).catch(function () {\n        _this5.passwordLoading = false;\n      });\n    },\n    recurSiveFilter: function recurSiveFilter(getDrawingList) {\n      var _this6 = this;\n      var newColumn = getDrawingList.filter(function (item) {\n        return getFormDataFields(item);\n      });\n      newColumn.forEach(function (x) {\n        return x.__config__ && x.__config__.children && Array.isArray(x.__config__.children) && (x.__config__.children = _this6.recurSiveFilter(x.__config__.children));\n      });\n      return newColumn;\n    },\n    isIncludesTable: function isIncludesTable(data) {\n      if ((!data.__config__.layout || data.__config__.layout === 'rowFormItem') && data.__config__.jnpfKey !== 'table') return true;\n      return data.__config__.jnpfKey == 'table';\n    },\n    selectFlow: function selectFlow(item) {\n      var _this7 = this;\n      this.flowItem = item;\n      var data = {\n        id: '',\n        enCode: this.config.flowEnCode,\n        flowId: item.id,\n        formType: 2,\n        opType: '-1',\n        type: 1,\n        modelId: this.modelId,\n        isPreview: this.isPreview,\n        fromForm: 1,\n        hideCancelBtn: true\n      };\n      this.flowListVisible = false;\n      this.flowVisible = true;\n      this.$nextTick(function () {\n        _this7.$refs.FlowBox.init(data);\n      });\n    },\n    submitForm: function submitForm(data, callback) {\n      var _this8 = this;\n      if (!data) return;\n      this.btnLoading = true;\n      this.dataForm.data = JSON.stringify(data);\n      (0, _webDesign.createModel)(this.modelId, this.dataForm, this.encryption).then(function (res) {\n        _this8.$message({\n          message: res.msg,\n          type: 'success',\n          duration: 1500,\n          onClose: function onClose() {\n            if (callback && typeof callback === \"function\") callback();\n            _this8.btnLoading = false;\n            _this8.resetForm();\n          }\n        });\n      }).catch(function () {\n        _this8.btnLoading = false;\n      });\n    },\n    getQRimg: function getQRimg() {\n      if (!this.formLink) {\n        return;\n      }\n      this.$refs.qrCode.innerHTML = \"\";\n      this.qrcode = new _qrcodejs.default(this.$refs.qrCode, {\n        width: 150,\n        height: 150,\n        // 高度\n        text: this.formLink,\n        // 二维码内容\n        // render: 'canvas' // 设置渲染方式（有两种方式 table和canvas，默认是canvas）\n        // background: '#f0f'\n        // foreground: '#ff0'\n        correctLevel: _qrcodejs.default.CorrectLevel.H //容错级别 容错级别有：（1）QRCode.CorrectLevel.L （2）QRCode.CorrectLevel.M （3）QRCode.CorrectLevel.Q （4）QRCode.CorrectLevel.H\n      });\n    },\n    dataFormSubmit: function dataFormSubmit() {\n      if (this.isPreview) return this.$message({\n        message: '功能预览不支持数据保存',\n        type: 'warning'\n      });\n      this.$refs.dynamicForm && this.$refs.dynamicForm.submitForm();\n    },\n    resetForm: function resetForm() {\n      var _this9 = this;\n      this.formConf = JSON.parse(this.config.formData);\n      this.fillFormData(this.formConf, {});\n      this.formConf.fields = this.recurSiveFilter(this.formConf.fields);\n      this.$nextTick(function () {\n        _this9.$refs.dynamicForm && _this9.$refs.dynamicForm.resetForm();\n      });\n    },\n    closeFlow: function closeFlow(isRefresh) {\n      if (isRefresh) this.init(true);\n    }\n  }\n};",null]}