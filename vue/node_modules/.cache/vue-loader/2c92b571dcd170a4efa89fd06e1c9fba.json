{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/integrationProcess/PropPanel/UpdateDataNode.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/integrationProcess/PropPanel/UpdateDataNode.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport FlowFormModal from './FormListModal';\nimport { sourceTypeOptions, logicOptions, symbolOptions, baseSymbolOptions, rangeSymbolOptions, selectSymbolOptions, switchSymbolOptions, relationFormSymbolOptions, useRangeSymbolList, useSelectSymbolList, useSwitchSymbolList, useRelationFormSymbolList } from '../FlowCard/define.js';\nimport MsgDialog from '@/components/Process/PropPanel/msgDialog'\nimport { getDictionaryDataSelector } from '@/api/systemData/dictionary';\nimport { getDataInterfaceRes } from '@/api/systemData/dataInterface';\nimport { dyOptionsList } from '@/components/Generator/generator/comConfig'\nconst unFoundRuleOptions = [\n  { id: 0, fullName: '跳过不更新' },\n  { id: 1, fullName: '新增一条数据' },\n];\nconst emptyChildItem = { field: '', symbol: '', fieldValueType: 1, fieldValue: undefined, jnpfKey: '', fieldValueJnpfKey: '', cellKey: +new Date() };\nconst emptyItem = { logic: 'and', groups: [emptyChildItem] };\n\nexport default {\n  name: 'UpdateDataNode',\n  components: { FlowFormModal, MsgDialog },\n  props: {\n    formConf: {\n      type: Object,\n      default: () => { }\n    },\n    integrateType: {\n      type: Number,\n      default: 1\n    },\n    formFieldsOptions: {\n      type: Array,\n      default: () => []\n    },\n    getFormFieldList: {\n      type: Function,\n      default: null\n    },\n    usedFormItems: {\n      type: Array,\n      default: () => []\n    },\n    flowOptions: {\n      type: Array,\n      default: () => []\n    },\n  },\n  data() {\n    return {\n      unFoundRuleOptions,\n      emptyItem,\n      sourceTypeOptions,\n      logicOptions,\n      symbolOptions,\n      emptyChildItem,\n      ruleMatchLogic: JSON.parse(JSON.stringify(this.formConf.ruleMatchLogic)),\n      transferList: JSON.parse(JSON.stringify(this.formConf.transferList)),\n      ruleList: JSON.parse(JSON.stringify(this.formConf.ruleList)),\n      unFoundRule: JSON.parse(JSON.stringify(this.formConf.unFoundRule)),\n      baseSymbolOptions,\n      rangeSymbolOptions,\n      selectSymbolOptions,\n      switchSymbolOptions,\n      relationFormSymbolOptions,\n      useRangeSymbolList,\n      useSelectSymbolList,\n      useSwitchSymbolList,\n      useRelationFormSymbolList,\n      flowId: ''\n    }\n  },\n  computed: {\n    getRuleOptions() {\n      let formFieldList = this.formConf.formFieldList.filter(o => o.id.indexOf('-') < 0)\n      return formFieldList.filter(o => !['relationFormAttr', 'popupAttr', 'uploadFile', 'uploadImg', 'colorPicker', 'editor'].includes(o.__config__.jnpfKey))\n    }\n  },\n  watch: {\n    getRuleOptions: {\n      handler(val) {\n        this.buildOptions(val)\n      },\n      deep: true\n    }\n  },\n  methods: {\n    getSymbolOptions(jnpfKey) {\n      if (this.useSwitchSymbolList.includes(jnpfKey)) return this.switchSymbolOptions;\n      if (this.useRelationFormSymbolList.includes(jnpfKey)) return this.relationFormSymbolOptions;\n      if (this.useRangeSymbolList.includes(jnpfKey)) return this.rangeSymbolOptions;\n      if (this.useSelectSymbolList.includes(jnpfKey)) return this.selectSymbolOptions;\n      return this.baseSymbolOptions;\n    },\n    input() {\n      this.$forceUpdate()\n    },\n    getTransferList() {\n      this.formConf.flowId = this.flowId\n      let item = {\n        unFoundRule: this.unFoundRule,\n        transferList: this.transferList,\n        ruleList: this.ruleList,\n        ruleMatchLogic: this.ruleMatchLogic\n      }\n      return item\n    },\n    onFormIdChange(id, item) {\n      this.formConf.transferList = [];\n      this.ruleList = []\n      this.formConf.ruleList = []\n      this.formConf.flowId = '';\n      this.flowId = ''\n      if (!id) return this.handleNull();\n      this.formConf.formName = item.fullName;\n      this.formConf.formId = id;\n      this.formConf.enableFlow = item.enableFlow;\n      this.getFormFieldList(id, 'updateData');\n      this.transferList = []\n      if (this.integrateType != 1) {\n        this.ruleMatchLogic = 'and'\n        let emptyItem = JSON.parse(JSON.stringify(this.emptyItem))\n        emptyItem.groups[0].symbol = '=='\n        this.ruleList.push(emptyItem);\n        this.formConf.ruleList = this.ruleList\n      }\n    },\n    handleNull() {\n      this.formConf.formName = '';\n      this.formConf.formId = '';\n      this.formConf.enableFlow = 0;\n      this.formConf.formFieldList = [];\n      this.transferList = []\n      this.ruleList = []\n    },\n    addTransferItem() {\n      this.transferList.push({ targetField: '', targetFieldLabel: '', sourceType: 1, sourceValue: '', required: false });\n    },\n    delTransferItem(index) {\n      this.transferList.splice(index, 1);\n    },\n    addItem(index) {\n      let emptyChildItem = JSON.parse(JSON.stringify(this.emptyChildItem))\n      if (this.integrateType != 1) emptyChildItem.symbol = '=='\n      this.ruleList[index].groups.push(emptyChildItem);\n    },\n    delItem(index, childIndex) {\n      if (this.integrateType != 1 && this.ruleList.length <= 1 && this.ruleList[0].groups.length <= 1) {\n        this.$message.error('必须保留一个条件');\n        return;\n      }\n      this.ruleList[index].groups.splice(childIndex, 1);\n    },\n    addGroup() {\n      let emptyItem = JSON.parse(JSON.stringify(this.emptyItem))\n      if (this.integrateType != 1) emptyItem.groups[0].symbol = '=='\n      this.ruleList.push(emptyItem);\n    },\n    delGroup(index) {\n      if (this.integrateType != 1 && this.ruleList.length <= 1) return this.$message.error('必须保留一个条件');\n      this.ruleList.splice(index, 1);\n    },\n    onFieldChange(item, val, index, childIndex) {\n      item.cellKey = +new Date()\n      item.symbol = ''\n      if (!val) {\n        item.jnpfKey = '';\n        if (item.fieldValueType == 2) {\n          item.fieldValue = undefined;\n          item.fieldValueJnpfKey = '';\n        }\n        return;\n      }\n      let data = this.getRuleOptions.filter(o => o.id == val)[0];\n      item.jnpfKey = data.__config__.jnpfKey;\n      const newItem = JSON.parse(JSON.stringify(this.emptyChildItem));\n      for (let key of Object.keys(newItem)) {\n        newItem[key] = item[key];\n      }\n      item = { ...newItem, ...data };\n      if (item.fieldValueType == 2) {\n        item.fieldValue = undefined;\n        item.fieldValueJnpfKey = '';\n      }\n      if (this.integrateType != 1) item.symbol = '=='\n      this.$set(this.ruleList[index].groups, childIndex, item);\n    },\n    onTypeChange(item) {\n      if (item.fieldValueType == 1) {\n        if (item.fieldValue || item.jnpfKey == 'switch') item.fieldValue = undefined\n      } else {\n        item.fieldValue = [\"in\", \"notIn\"].includes(item.symbol) ? [] : undefined\n        if (item.jnpfKey == 'switch') item.fieldValue = false\n      }\n    },\n    onSymbolChange(val, item, i, childIndex) {\n      item.cellKey = +new Date()\n      item.fieldValueType = 1;\n      item.fieldValue = undefined;\n      item.fieldValueJnpfKey = '';\n      item.disabled = ['null', 'notNull'].includes(val);\n      item.multiple = [\"in\", \"notIn\"].includes(val);\n      if (['select', 'radio', 'checkbox', 'areaSelect'].includes(item.jnpfKey)) {\n        if ([\"in\", \"notIn\"].includes(val)) {\n          item.fieldValue = []\n        } else {\n          item.fieldValue = ''\n        }\n      }\n      this.$set(this.ruleList[i].groups, childIndex, item);\n    },\n    getTargetOptions(index) {\n      let ignoreOptions = [];\n      for (let i = 0; i < this.transferList.length; i++) {\n        const e = this.transferList[i];\n        if (e.targetField && index !== i) ignoreOptions.push(e.targetField);\n      }\n      const list = this.formConf.formFieldList.filter(o => !ignoreOptions.includes(o.id));\n      return list;\n    },\n    buildOptions(componentList) {\n      componentList.forEach(cur => {\n        cur.disabled = false;\n        const config = cur.__config__;\n        if (dyOptionsList.includes(config.jnpfKey)) {\n          if (config.dataType === 'dictionary' && config.dictionaryType) {\n            cur.options = []\n            getDictionaryDataSelector(config.dictionaryType).then(res => {\n              cur.options = res.data.list;\n            });\n          }\n          if (config.dataType === 'dynamic' && config.propsUrl) {\n            cur.options = []\n            getDataInterfaceRes(config.propsUrl).then(res => {\n              cur.options = Array.isArray(res.data) ? res.data : [];\n            });\n          }\n        }\n      });\n      return componentList;\n    },\n  }\n}\n\n",null]}