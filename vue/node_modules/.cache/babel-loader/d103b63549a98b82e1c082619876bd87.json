{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/VisualPortal/PortalDesign/components/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/VisualPortal/PortalDesign/components/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es6.function.name\");\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es7.array.includes\");\nrequire(\"core-js/modules/es6.string.includes\");\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _typeof2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/typeof.js\"));\nvar _vueGridLayout = _interopRequireDefault(require(\"vue-grid-layout\"));\nvar _utils = require(\"@/utils\");\nvar _config = require(\"./config\");\nvar _data = require(\"@/components/VisualPortal/PortalDesign/components/data\");\nvar _Preview = _interopRequireDefault(require(\"./Preview\"));\nvar _CardHeader = _interopRequireDefault(require(\"@/components/VisualPortal/CardHeader\"));\nvar _RightPanel = _interopRequireDefault(require(\"./RightPanel\"));\nvar _parser = _interopRequireDefault(require(\"./parser\"));\nvar _vuedraggable = _interopRequireDefault(require(\"vuedraggable\"));\nvar _validate = require(\"@/utils/validate\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } //\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar defaultConf = {\n  layoutId: 100,\n  layout: [],\n  refresh: {\n    autoRefresh: false,\n    autoRefreshTime: '5'\n  }\n};\nvar _default = exports.default = {\n  name: 'JNPF-PortalDesigner',\n  props: ['conf', 'showType'],\n  components: {\n    GridLayout: _vueGridLayout.default.GridLayout,\n    GridItem: _vueGridLayout.default.GridItem,\n    Preview: _Preview.default,\n    RightPanel: _RightPanel.default,\n    draggable: _vuedraggable.default,\n    CardHeader: _CardHeader.default,\n    parser: _parser.default\n  },\n  data: function data() {\n    return {\n      componentsList: [{\n        title: '布局控件',\n        list: _config.layoutComponents\n      }, {\n        title: '基础控件',\n        list: _config.basicComponents\n      }, {\n        title: '系统控件',\n        list: _config.systemComponents\n      }, {\n        title: '图表控件',\n        list: _config.chartComponents\n      }],\n      layout: [],\n      activeId: null,\n      activeData: null,\n      refresh: {},\n      previewVisible: false,\n      noNeedMaskList: _config.noNeedMaskList,\n      config: {},\n      copyDrawingList: ''\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n    if ((0, _typeof2.default)(this.conf) === 'object' && this.conf !== null) {\n      this.config = _objectSpread(_objectSpread({}, defaultConf), this.conf);\n    } else {\n      this.config = (0, _utils.deepClone)(defaultConf);\n      this.config.layoutId = 100;\n    }\n    this.layout = this.config.layout || [];\n    this.refresh = this.config.refresh || {};\n    setTimeout(function () {\n      _this.addLocalRecord(_this.layout);\n      _this.setActiveData();\n    }, 50);\n    this.$eventBus.$on('addComponent', function (val, currentVal, index) {\n      _this.addComponent(val, '', currentVal, index);\n    });\n    this.$eventBus.$on('handlerActive', function (val) {\n      _this.handleClick(val);\n    });\n  },\n  beforeDestroy: function beforeDestroy() {\n    if (this.activeData && this.activeData.i) this.$eventBus.$off('eChart' + this.activeData.i);\n    this.$eventBus.$off('addComponent');\n    this.$eventBus.$off('handlerActive');\n  },\n  methods: {\n    handleData: function handleData(data) {\n      var _this2 = this;\n      this.layout = JSON.parse(JSON.stringify(data));\n      this.copyDrawingList = JSON.stringify(this.layout);\n      var boo = false;\n      var loop = function loop(list) {\n        for (var i = 0; i < list.length; i++) {\n          var e = list[i];\n          if (e.i === _this2.activeId) {\n            _this2.activeData = e;\n            _this2.activeId = e.i;\n            boo = true;\n          }\n          if (e.children && Array.isArray(e.children)) loop(e.children);\n        }\n      };\n      loop(this.layout);\n      if (!boo) {\n        this.activeData = {};\n        this.activeId = null;\n      }\n    },\n    addLocalRecord: function addLocalRecord(val) {\n      if (JSON.stringify(val) != this.copyDrawingList) {\n        this.copyDrawingList = JSON.stringify(val);\n        this.$emit('addRecord', val);\n      }\n    },\n    setActiveData: function setActiveData() {\n      var i = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n      this.activeId = null;\n      this.activeData = {};\n      if (this.layout.length) {\n        this.activeData = this.layout[i];\n        this.activeId = this.layout[i].i;\n      }\n    },\n    getData: function getData() {\n      var _this3 = this;\n      return new Promise(function (resolve, reject) {\n        var loop = function loop(list) {\n          for (var i = 0; i < list.length; i++) {\n            var e = list[i];\n            var option = e.option || {};\n            var card = e.card || {};\n            if (card.cardRightBtn) {\n              if (card.linkType === '1' && !card.urlAddress) {\n                reject({\n                  msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u83DC\\u5355\\u540D\\u79F0\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                  target: 1\n                });\n                break;\n              }\n              if (card.linkType === '2') {\n                if (!card.urlAddress) {\n                  reject({\n                    msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u94FE\\u63A5\\u5730\\u5740\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                    target: 1\n                  });\n                  break;\n                }\n                if (!(0, _validate.validURL)(card.urlAddress)) {\n                  reject({\n                    msg: '请输入正确的链接地址',\n                    target: 1\n                  });\n                  break;\n                }\n              }\n              if (card.appLinkType === '1' && !card.appUrlAddress) {\n                reject({\n                  msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u83DC\\u5355\\u540D\\u79F0\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                  target: 1\n                });\n                break;\n              }\n              if (card.appLinkType === '2') {\n                if (!card.appUrlAddress) {\n                  reject({\n                    msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u94FE\\u63A5\\u5730\\u5740\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                    target: 1\n                  });\n                  break;\n                }\n                if (!(0, _validate.validURL)(card.appUrlAddress)) {\n                  reject({\n                    msg: '请输入正确的链接地址',\n                    target: 1\n                  });\n                  break;\n                }\n              }\n            }\n            if (option.linkType === '1' && !option.urlAddress) {\n              reject({\n                msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u83DC\\u5355\\u540D\\u79F0\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                target: 1\n              });\n              break;\n            }\n            if (option.linkType === '2') {\n              if (!option.urlAddress) {\n                reject({\n                  msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u94FE\\u63A5\\u5730\\u5740\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                  target: 1\n                });\n                break;\n              }\n              if (!(0, _validate.validURL)(option.urlAddress)) {\n                reject({\n                  msg: '请输入正确的链接地址',\n                  target: 1\n                });\n                break;\n              }\n            }\n            if (option.appLinkType === '1' && !option.appUrlAddress) {\n              reject({\n                msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u83DC\\u5355\\u540D\\u79F0\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                target: 1\n              });\n              break;\n            }\n            if (option.appLinkType === '2') {\n              if (!option.appUrlAddress) {\n                reject({\n                  msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u94FE\\u63A5\\u5730\\u5740\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                  target: 1\n                });\n                break;\n              }\n              if (!(0, _validate.validURL)(option.appUrlAddress)) {\n                reject({\n                  msg: '请输入正确的链接地址',\n                  target: 1\n                });\n                break;\n              }\n            }\n            if ((e.jnpfKey == 'video' || e.jnpfKey == 'image') && option.styleType == 2) {\n              var val = e.jnpfKey == 'video' ? '视频' : '图片';\n              if (!option.defaultValue) {\n                reject({\n                  msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\").concat(val, \"\\u5730\\u5740\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                  target: 1\n                });\n                break;\n              }\n              if (!(0, _validate.validURL)(option.defaultValue)) {\n                reject({\n                  msg: \"\\u8BF7\\u8F93\\u5165\\u6B63\\u786E\\u7684\".concat(val, \"\\u5730\\u5740\"),\n                  target: 1\n                });\n                break;\n              }\n            }\n            if (e.jnpfKey == 'iframe') {\n              if (!option.defaultValue) {\n                reject({\n                  msg: \"\".concat(e.label, \"\\u63A7\\u4EF6\\u201C\\u94FE\\u63A5\\u5730\\u5740\\u201D\\u5C5E\\u6027\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n                  target: 1\n                });\n                break;\n              }\n              if (!(0, _validate.validURL)(option.defaultValue)) {\n                reject({\n                  msg: '请输入正确的链接地址',\n                  target: 1\n                });\n                break;\n              }\n            }\n            if (e.children && Array.isArray(e.children)) loop(e.children);\n          }\n        };\n        loop(_this3.layout);\n        _this3.config.layout = _this3.layout;\n        resolve({\n          formData: _this3.config,\n          target: 1\n        });\n      });\n    },\n    addComponent: function addComponent(item, type, currentItem, index) {\n      var clone = (0, _utils.deepClone)(item);\n      var x = 0,\n        y = 0,\n        i = this.config.layoutId;\n      if (this.layout.length) {\n        var maxYItem = {\n          y: 0,\n          h: 0\n        };\n        for (var _i = 0; _i < this.layout.length; _i++) {\n          if (this.layout[_i].y >= maxYItem.y) maxYItem = this.layout[_i];\n        }\n        y = maxYItem.y + maxYItem.h;\n      }\n      var row = _objectSpread(_objectSpread({}, clone), {}, {\n        i: i,\n        x: x,\n        y: y\n      });\n      if (_config.needDefaultList.includes(row.jnpfKey) && type != 'copy') row.option.defaultValue = this.getDefaultValue(row);\n      if (currentItem) {\n        if (currentItem.jnpfKey == 'card') currentItem.children.push(row);\n        if (currentItem.jnpfKey == 'collapse') currentItem.children[index].children.push(row);\n        if (currentItem.jnpfKey == 'tab') {\n          currentItem.children.forEach(function (element) {\n            if (element.name == currentItem.active) element.children.push(row);\n          });\n        }\n      } else {\n        this.layout.push(row);\n      }\n      this.activeId = this.config.layoutId;\n      this.activeData = row;\n      this.config.layoutId++;\n      this.addLocalRecord(this.layout);\n    },\n    getDefaultValue: function getDefaultValue(row) {\n      var jnpfKey = row.jnpfKey;\n      if (jnpfKey == 'text') return \"JNPF快速开发平台\";\n      if (jnpfKey == 'image') return \"https://app.cdn.jnpfsoft.com/image/3.2/banner1.png\";\n      if (jnpfKey == 'video') return \"https://cdn.jnpfsoft.com/2022/video/index_video.mp4\";\n      if (jnpfKey == 'barChart' || jnpfKey == 'lineChart' || jnpfKey == 'pieChart') return _data.chartData.baseBarData;\n      if (jnpfKey == 'radarChart') return _data.chartData.radarData;\n      if (jnpfKey == 'mapChart') return _data.mapChartData;\n      if (jnpfKey == 'rankList') return _data.rankList;\n      if (jnpfKey == 'timeAxis') return _data.timeAxisList;\n      if (jnpfKey == 'tableList') return _data.tableList;\n    },\n    handleRemoveItem: function handleRemoveItem(i) {\n      var _this4 = this;\n      this.layout = this.layout.filter(function (item) {\n        return item.i !== i;\n      });\n      this.activeId = null;\n      this.activeData = {};\n      this.addLocalRecord(this.layout);\n      this.$nextTick(function () {\n        var len = _this4.layout.length;\n        if (len) _this4.setActiveData(len - 1);\n      });\n    },\n    empty: function empty() {\n      var _this5 = this;\n      this.$confirm('确定要清空所有吗？', '提示', {\n        type: 'warning'\n      }).then(function () {\n        _this5.layout = [];\n        _this5.config.layoutId = 100;\n        _this5.activeId = null;\n        _this5.activeData = {};\n        _this5.addLocalRecord(_this5.layout);\n      }).catch(function () {});\n    },\n    preview: function preview() {\n      this.previewVisible = true;\n    },\n    handleClick: function handleClick(item) {\n      this.activeId = item.i;\n      this.activeData = item;\n    },\n    resizedEvent: function resizedEvent(i, item) {\n      var _this6 = this;\n      this.$eventBus.$emit('eChart' + i);\n      var loop = function loop(data) {\n        if (data.children && item.children.length) {\n          data.children.map(function (ele) {\n            if (ele.jnpfKey) _this6.$eventBus.$emit('eChart' + ele.i);\n            if (ele.children && ele.children.length) loop(ele);\n          });\n        }\n      };\n      loop(item);\n      this.addLocalRecord(this.layout);\n    },\n    movedEvent: function movedEvent() {\n      this.addLocalRecord(this.layout);\n    }\n  }\n};",null]}