{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/login/index.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/login/index.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es6.regexp.replace\");\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es6.object.keys\");\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _user = require(\"@/api/user\");\nvar _socialsUser = require(\"@/api/permission/socialsUser\");\nvar _qs = _interopRequireDefault(require(\"qs\"));\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } //\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = exports.default = {\n  name: 'Login',\n  data: function data() {\n    return {\n      loginForm: {\n        account: '',\n        password: '',\n        code: '',\n        origin: 'password'\n      },\n      loginRules: {\n        account: [{\n          required: true,\n          trigger: 'blur',\n          message: this.$t('login.accountTip')\n        }],\n        password: [{\n          required: true,\n          trigger: 'blur',\n          message: this.$t('login.passwordTip')\n        }],\n        code: [{\n          required: true,\n          trigger: 'blur',\n          message: this.$t('login.codeTip')\n        }]\n      },\n      imgUrl: \"\",\n      timestamp: '',\n      capsTooltip: false,\n      loading: false,\n      showDialog: false,\n      needCode: false,\n      codeLength: 4,\n      redirect: undefined,\n      showTxt: false,\n      otherQuery: {},\n      active: 1,\n      listenerLoad: false,\n      visible: false,\n      show: false,\n      ssoLoading: true,\n      isSso: false,\n      preUrl: '',\n      ssoUrl: '',\n      ssoTicket: \"\",\n      ticketParams: \"\",\n      ssoTimer: null,\n      socialsList: [],\n      dialogVisible: false,\n      tenantSocialList: [],\n      redirectUrl: ''\n    };\n  },\n  computed: {\n    sysConfig: function sysConfig() {\n      return this.$store.state.settings.sysConfig;\n    },\n    loginLoading: function loginLoading() {\n      return this.$store.state.user.loginLoading;\n    }\n  },\n  watch: {\n    loginLoading: function loginLoading(val) {\n      if (!val) this.loading = false;\n    },\n    visible: function visible(val) {\n      if (!val) {\n        this.loading = false;\n        this.show = false;\n        this.clearTimer();\n      }\n    },\n    $route: {\n      handler: function handler(route) {\n        var query = route.query;\n        if (query) {\n          this.redirect = query.redirect;\n          this.otherQuery = this.getOtherQuery(query);\n        }\n      },\n      immediate: true\n    }\n  },\n  created: function created() {\n    var _this = this;\n    document.onkeydown = function (e) {\n      var keyCode = e.keyCode;\n      if (keyCode === 13) {\n        _this.handleLogin();\n      }\n    };\n    if (this.needCode) this.changeImg();\n    this.getLoginConfig();\n  },\n  mounted: function mounted() {\n    var _this2 = this;\n    this.$store.commit('user/SET_LOGIN_LOADING', false);\n    this.setShowTxt();\n    window.onresize = function () {\n      _this2.setShowTxt();\n    };\n  },\n  destroyed: function destroyed() {\n    document.onkeydown = function (e) {\n      var keyCode = e.keyCode;\n      if (keyCode === 13) {}\n    };\n  },\n  methods: {\n    setShowTxt: function setShowTxt() {\n      if (document.documentElement.clientHeight <= 840) {\n        this.showTxt = false;\n      } else {\n        this.showTxt = true;\n      }\n    },\n    checkCapslock: function checkCapslock(e) {\n      var key = e.key;\n      this.capsTooltip = key && key.length === 1 && key >= 'A' && key <= 'Z';\n    },\n    getConfig: function getConfig(val) {\n      var _this3 = this;\n      if (!val) return;\n      (0, _user.getConfig)(this.loginForm.account).then(function (res) {\n        _this3.needCode = !!res.data.enableVerificationCode;\n        if (_this3.needCode) {\n          _this3.codeLength = res.data.verificationCodeNumber || 4;\n          _this3.changeImg();\n        }\n      });\n    },\n    handleLogin: function handleLogin() {\n      var _this4 = this;\n      if (this.loading) return;\n      this.$refs.loginForm.validate(function (valid) {\n        if (valid) {\n          _this4.loading = true;\n          _this4.$store.commit('user/SET_LOGIN_LOADING', true);\n          var query = _objectSpread(_objectSpread({}, _this4.loginForm), {}, {\n            timestamp: _this4.timestamp,\n            jnpf_ticket: _this4.ssoTicket\n          });\n          _this4.$store.dispatch('user/login', query).then(function (res) {\n            _this4.$router.push({\n              path: _this4.redirect || '/home',\n              query: _this4.otherQuery\n            });\n          }).catch(function () {\n            if (_this4.needCode) {\n              _this4.changeImg();\n              _this4.loginForm.code = '';\n            }\n            _this4.$store.commit('user/SET_LOGIN_LOADING', false);\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    changeImg: function changeImg() {\n      var timestamp = Math.random();\n      this.timestamp = timestamp;\n      this.imgUrl = \"/api/oauth/ImageCode/\".concat(this.codeLength || 4, \"/\").concat(timestamp);\n    },\n    getOtherQuery: function getOtherQuery(query) {\n      return Object.keys(query).reduce(function (acc, cur) {\n        if (cur !== 'redirect') {\n          acc[cur] = query[cur];\n        }\n        return acc;\n      }, {});\n    },\n    otherLoginList: function otherLoginList() {\n      var _this5 = this;\n      this.socialsList = [];\n      (0, _socialsUser.getSocialsLoginList)().then(function (res) {\n        _this5.socialsList = res.data.filter(function (item) {\n          return item.isLatest == \"true\";\n        });\n      });\n    },\n    otherLogin: function otherLogin(data) {\n      var _this6 = this;\n      (0, _socialsUser.getTicket)().then(function (res) {\n        _this6.ssoTicket = res.data;\n        if (_this6.winURL && !_this6.winURL.closed) {\n          _this6.winURL.location.replace(_this6.redirectUrl);\n          _this6.winURL.focus();\n          return;\n        }\n        _this6.socialsList.forEach(function (item) {\n          if (data == item.enname) {\n            var renderUrl = item.renderUrl.replace('JNPF_TICKET', _this6.ssoTicket);\n            _this6.redirectUrl = renderUrl;\n          }\n        });\n        var iWidth = 750; //弹出窗口的宽度;\n        var iHeight = 500; //弹出窗口的高度;\n        var iLeft = (window.screen.width - iWidth) / 2;\n        var iTop = (window.screen.height - iHeight) / 2; //获得窗口的垂直位置;\n        _this6.winURL = window.open(_this6.redirectUrl, '_blank', 'height=' + iHeight + ',innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');\n        _this6.ssoTimer = setInterval(function () {\n          if (_this6.winURL.closed) {\n            _this6.clearTimer();\n          }\n          _this6.getTicketStatus();\n        }, 1000);\n      });\n    },\n    getTicketStatus: function getTicketStatus() {\n      var _this7 = this;\n      if (!this.ssoTicket) return;\n      (0, _socialsUser.getTicketStatus)(this.ssoTicket).then(function (res) {\n        if (res.data.status != 2) {\n          _this7.winURL && _this7.winURL.close();\n          if (res.data.status == 4) {\n            //未绑定预留ticket\n            clearInterval(_this7.ssoTimer);\n            _this7.ssoTimer = null;\n          } else {\n            _this7.clearTimer();\n          }\n          switch (res.data.status) {\n            case 1:\n              //登陆成功\n              var param = {\n                theme: res.data.theme,\n                token: res.data.value\n              };\n              _this7.$store.dispatch('user/setToken', param).then(function (res) {\n                _this7.$router.push({\n                  path: _this7.redirect || '/home',\n                  query: _this7.otherQuery\n                });\n              });\n              break;\n            case 4:\n              //未绑定\n              _this7.$message.error('第三方账号未绑定，5分钟内登录本系统账号密码自动绑定该账号！');\n              _this7.visible = false;\n              _this7.ssoUrl = '';\n              break;\n            case 6:\n              //多租户绑定多个\n              _this7.dialogVisible = true;\n              _this7.tenantSocialList = typeof res.data.value === 'string' ? JSON.parse(res.data.value) : res.data.value;\n              break;\n            default:\n              _this7.$message.error(res.data.value || '账号异常！');\n              _this7.visible = false;\n              _this7.ssoUrl = '';\n              _this7.getLoginConfig();\n              break;\n          }\n        }\n      });\n    },\n    clearTimer: function clearTimer() {\n      if (this.ssoTimer) {\n        clearInterval(this.ssoTimer);\n        this.ssoTimer = null;\n        this.ssoTicket = '';\n      }\n    },\n    handleClose: function handleClose() {\n      this.dialogVisible = false;\n    },\n    socailsLogin: function socailsLogin(data) {\n      var _this8 = this;\n      (0, _socialsUser.socialsLogin)(_qs.default.stringify(_objectSpread(_objectSpread({}, data), {}, {\n        tenantLogin: true\n      }))).then(function (response) {\n        if (response.code == 200) {\n          _this8.$store.dispatch('user/setToken', response.data).then(function (res) {\n            _this8.$router.push({\n              path: _this8.redirect || '/home',\n              query: _this8.otherQuery\n            });\n          });\n        }\n      });\n    },\n    ssoLogin: function ssoLogin() {\n      var _this9 = this;\n      if (this.loading) return;\n      this.loading = true;\n      (0, _socialsUser.getTicket)().then(function (res) {\n        _this9.ssoTicket = res.data;\n        _this9.ssoUrl = _this9.preUrl + '?' + _this9.ticketParams + '=' + _this9.ssoTicket;\n        _this9.visible = true;\n        _this9.ssoTimer = setInterval(function () {\n          _this9.getTicketStatus();\n        }, 1000);\n      });\n    },\n    getLoginConfig: function getLoginConfig() {\n      var _this10 = this;\n      (0, _socialsUser.getLoginConfig)().then(function (res) {\n        _this10.isSso = res.data.redirect;\n        _this10.preUrl = res.data.url;\n        _this10.ticketParams = res.data.ticketParams;\n        _this10.socialsList = res.data.socialsList || [];\n        localStorage.setItem('useSocials', _this10.socialsList.length);\n        _this10.ssoLoading = false;\n      }).catch(function () {\n        _this10.isSso = false;\n        _this10.ssoLoading = false;\n      });\n    },\n    onOpen: function onOpen() {\n      this.show = true;\n    }\n  }\n};",null]}