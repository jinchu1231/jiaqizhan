{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/views/system/printDev/Form.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/system/printDev/Form.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar _printDev = require(\"@/api/system/printDev\");\nvar _dataSource = require(\"@/api/systemData/dataSource\");\nvar _tsPrintTemplater = _interopRequireDefault(require(\"./ts-print-templater\"));\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = exports.default = {\n  components: {\n    PrintTemplater: _tsPrintTemplater.default\n  },\n  data: function data() {\n    return {\n      visible: false,\n      loading: false,\n      nextBtnLoading: false,\n      activeStep: 0,\n      showPrint: true,\n      dataForm: {\n        id: '',\n        fullName: '',\n        enCode: '',\n        dbLinkId: '0',\n        type: 1,\n        enabledMark: 1,\n        sortCode: 0,\n        category: '',\n        sqlTemplate: '',\n        leftFields: '',\n        printTemplate: '',\n        description: '',\n        pageParam: {}\n      },\n      dataRule: {\n        fullName: [{\n          required: true,\n          message: '模板名称不能为空',\n          trigger: 'blur'\n        }],\n        enCode: [{\n          required: true,\n          message: '模板编码不能为空',\n          trigger: 'blur'\n        }, {\n          validator: this.formValidate('enCode'),\n          trigger: 'blur'\n        }],\n        category: [{\n          required: true,\n          message: '模板分类不能为空',\n          trigger: 'change'\n        }],\n        dbLinkId: [{\n          required: true,\n          message: '数据连接不能为空',\n          trigger: 'change'\n        }],\n        sqlTemplate: [{\n          required: true,\n          message: 'SQL语句不能为空',\n          trigger: 'click'\n        }]\n      },\n      formVisible: false,\n      btnLoading: false,\n      sqlTemplate: [],\n      categoryList: [],\n      treeData: [],\n      dbOptions: [],\n      pageParam: {\n        mt: \"10\",\n        mb: \"10\",\n        ml: \"10\",\n        mr: \"10\",\n        type: \"2\",\n        width: 210,\n        height: 297,\n        direction: \"纵向\"\n      }\n    };\n  },\n  methods: {\n    pageParamInit: function pageParamInit(e) {\n      this.pageParam = e;\n    },\n    pageParamChange: function pageParamChange(pageParam) {\n      this.dataForm.pageParam = pageParam && JSON.stringify(pageParam);\n    },\n    init: function init(categoryList, id) {\n      var _this = this;\n      this.categoryList = categoryList;\n      this.activeStep = 0;\n      this.dataForm.id = id || '';\n      this.getDbOptions();\n      this.visible = true;\n      this.$nextTick(function () {\n        _this.$refs['dataForm'].resetFields();\n        if (_this.dataForm.id) {\n          _this.loading = true;\n          _this.showPrint = false;\n          (0, _printDev.getPrintDevInfo)(_this.dataForm.id).then(function (res) {\n            _this.dataForm = res.data;\n            _this.sqlTemplate = _this.dataForm.sqlTemplate && JSON.parse(_this.dataForm.sqlTemplate) || [];\n            var e = res.data.pageParam && JSON.parse(res.data.pageParam);\n            _this.pageParam = e;\n            _this.pageParam.direction = \"纵向\";\n            _this.showPrint = true;\n            _this.loading = false;\n          }).catch(function () {\n            _this.loading = false;\n          });\n          _this.showPrint = true;\n        }\n      });\n    },\n    dataFormSubmit: function dataFormSubmit() {\n      var _this2 = this;\n      this.btnLoading = true;\n      // this.dataForm.sqlTemplate = JSON.stringify(this.sqlTemplate)\n      var formMethod = this.dataForm.id ? _printDev.Update : _printDev.Create;\n      formMethod(this.dataForm).then(function (res) {\n        _this2.$message({\n          message: res.msg,\n          type: 'success',\n          duration: 1500,\n          onClose: function onClose() {\n            _this2.closeDialog(true);\n          }\n        });\n      }).catch(function () {\n        _this2.btnLoading = false;\n      });\n    },\n    delSql: function delSql(i) {\n      this.sqlTemplate.splice(i, 1);\n    },\n    addSql: function addSql() {\n      var item = {\n        sql: \"\"\n      };\n      this.sqlTemplate.push(item);\n    },\n    exist: function exist() {\n      if (!this.sqlTemplate.length) {\n        this.$message.error('请输入SQL语句');\n        return false;\n      }\n      var isOk = true;\n      //  遍历数组，判断非空\n      for (var i = 0; i < this.sqlTemplate.length; i++) {\n        var e = this.sqlTemplate[i];\n        if (!e.sql) {\n          this.$message({\n            message: \"\\u7B2C\".concat(i + 1, \"\\u884CSQL\\u8BED\\u53E5\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n            type: 'error',\n            duration: 1000\n          });\n          isOk = false;\n          break;\n        }\n      }\n      return isOk;\n    },\n    next: function next() {\n      var _this3 = this;\n      if (this.activeStep < 1) {\n        if (!this.exist()) return;\n        this.dataForm.sqlTemplate = JSON.stringify(this.sqlTemplate);\n        this.$refs['dataForm'].validate(function (valid) {\n          if (valid) {\n            _this3.nextBtnLoading = true;\n            var query = {\n              dbLinkId: _this3.dataForm.dbLinkId,\n              sqlTemplate: _this3.dataForm.sqlTemplate\n            };\n            (0, _printDev.getFields)(query).then(function (res) {\n              _this3.treeData = res.data;\n              _this3.activeStep += 1;\n              _this3.nextBtnLoading = false;\n            }).catch(function () {\n              _this3.nextBtnLoading = false;\n            });\n          }\n        });\n      }\n    },\n    closeDialog: function closeDialog(isRefresh) {\n      this.visible = false;\n      this.$emit('close', isRefresh);\n    },\n    prev: function prev() {\n      this.activeStep -= 1;\n    },\n    stepChick: function stepChick(key) {\n      if (this.activeStep <= key) return;\n      this.activeStep = key;\n    },\n    getDbOptions: function getDbOptions() {\n      var _this4 = this;\n      (0, _dataSource.getDataSourceListAll)().then(function (res) {\n        var list = res.data.list || [];\n        _this4.dbOptions = list.filter(function (o) {\n          return o.children && o.children.length;\n        });\n      });\n    }\n  }\n};",null]}