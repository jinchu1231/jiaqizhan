{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/src/mixins/generator/common.js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/mixins/generator/common.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es6.array.find-index\");\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _toConsumableArray2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/toConsumableArray.js\"));\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"regenerator-runtime/runtime\");\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/asyncToGenerator.js\"));\nvar _dataModel = require(\"@/api/systemData/dataModel\");\nvar _dataSource = require(\"@/api/systemData/dataSource\");\nvar _dataInterface = require(\"@/api/systemData/dataInterface\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nvar _default = exports.default = {\n  provide: function provide() {\n    return {\n      getFormInfo: this.getFormInfo\n    };\n  },\n  data: function data() {\n    return {};\n  },\n  created: function created() {\n    this.$store.dispatch('base/getPositionList');\n    this.$store.dispatch('base/getRoleList');\n    this.$store.dispatch('generator/getDepTree');\n    this.$store.dispatch('generator/getGroupTree');\n  },\n  methods: {\n    closeDialog: function closeDialog(isRefresh) {\n      this.visible = false;\n      this.$emit('close', isRefresh);\n      this.$store.state.generator.allTable = [];\n      this.$store.state.generator.ruleData = [];\n      this.$store.state.generator.complexHeaderData = [];\n    },\n    prev: function prev() {\n      this.activeStep -= 1;\n      if (this.activeStep == 0) this.updateTables();\n    },\n    stepChick: function stepChick(key) {\n      if (this.activeStep <= key) return;\n      this.activeStep = key;\n      if (this.activeStep == 0) this.updateTables();\n    },\n    updateTables: function updateTables() {\n      this.tables = this.$store.state.generator.allTable || [];\n      this.mainTableFields = this.$store.state.generator.formItemList || [];\n    },\n    onDbChange: function onDbChange() {\n      this.tables = [];\n    },\n    openTableBox: function openTableBox() {\n      if (!this.dataForm.dbLinkId) {\n        this.$message({\n          message: '请先选择数据库',\n          type: 'error',\n          duration: 1000\n        });\n        return;\n      }\n      this.formVisible = true;\n    },\n    closeForm: function () {\n      var _closeForm = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee(data) {\n        var _this = this;\n        var type, queryType, checkList, i, e, relationTable, typeId, res, fields, item, _loop, _i;\n        return regeneratorRuntime.wrap(function _callee$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              type = this.dataForm.type;\n              queryType = 0;\n              if (type == 3 || type == 4 || type == 5) queryType = 1;\n              checkList = [];\n              if (this.tables.length) {\n                _context2.next = 24;\n                break;\n              }\n              i = 0;\n            case 6:\n              if (!(i < data.length)) {\n                _context2.next = 19;\n                break;\n              }\n              e = data[i];\n              relationTable = data[0].table;\n              typeId = i == 0 ? \"1\" : \"0\";\n              _context2.next = 12;\n              return (0, _dataModel.DataModelFieldList)(this.dataForm.dbLinkId, e.table, queryType);\n            case 12:\n              res = _context2.sent;\n              fields = res.data.list;\n              item = {\n                relationField: \"\",\n                relationTable: i == 0 ? '' : relationTable,\n                table: e.table,\n                tableName: e.tableName,\n                tableField: '',\n                typeId: typeId,\n                fields: fields\n              };\n              checkList.push(item);\n            case 16:\n              i++;\n              _context2.next = 6;\n              break;\n            case 19:\n              this.relationTable = checkList[0].table;\n              this.mainTableFields = checkList[0].fields;\n              this.tables = checkList;\n              _context2.next = 32;\n              break;\n            case 24:\n              _loop = /*#__PURE__*/regeneratorRuntime.mark(function _loop() {\n                var e, boo, _res, _fields, _item;\n                return regeneratorRuntime.wrap(function _loop$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      e = data[_i];\n                      boo = _this.tables.some(function (o) {\n                        return o.table == e.table;\n                      });\n                      if (boo) {\n                        _context.next = 9;\n                        break;\n                      }\n                      _context.next = 5;\n                      return (0, _dataModel.DataModelFieldList)(_this.dataForm.dbLinkId, e.table, queryType);\n                    case 5:\n                      _res = _context.sent;\n                      _fields = _res.data.list;\n                      _item = {\n                        relationField: \"\",\n                        relationTable: _this.relationTable,\n                        table: e.table,\n                        tableName: e.tableName,\n                        tableField: '',\n                        typeId: \"0\",\n                        fields: _fields\n                      };\n                      checkList.push(_item);\n                    case 9:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }, _loop);\n              });\n              _i = 0;\n            case 26:\n              if (!(_i < data.length)) {\n                _context2.next = 31;\n                break;\n              }\n              return _context2.delegateYield(_loop(), \"t0\", 28);\n            case 28:\n              _i++;\n              _context2.next = 26;\n              break;\n            case 31:\n              this.tables = [].concat((0, _toConsumableArray2.default)(this.tables), checkList);\n            case 32:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee, this);\n      }));\n      function closeForm(_x) {\n        return _closeForm.apply(this, arguments);\n      }\n      return closeForm;\n    }(),\n    updateFields: function () {\n      var _updateFields = (0, _asyncToGenerator2.default)( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(webType) {\n        var _this2 = this;\n        var type, queryType, i, res, fields;\n        return regeneratorRuntime.wrap(function _callee2$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!(webType == 4)) {\n                _context3.next = 4;\n                break;\n              }\n              if (!this.dataForm.interfaceId) {\n                _context3.next = 4;\n                break;\n              }\n              _context3.next = 4;\n              return (0, _dataInterface.getDataInterfaceInfo)(this.dataForm.interfaceId).then(function (res) {\n                var data = res.data;\n                _this2.viewFields = data.fieldJson ? JSON.parse(data.fieldJson) : [];\n                _this2.dataForm.interfaceName = data.fullName;\n                var parameterJson = (data.parameterJson ? JSON.parse(data.parameterJson) : []).map(function (o) {\n                  return _objectSpread(_objectSpread({}, o), {}, {\n                    useSearch: false,\n                    disabled: false\n                  });\n                });\n                var _loop2 = function _loop2(i) {\n                  var findIndex = _this2.interfaceParam.findIndex(function (o) {\n                    return o.field === parameterJson[i].field;\n                  });\n                  if (findIndex > -1) parameterJson[i] = _this2.interfaceParam[findIndex];\n                };\n                for (var i = 0; i < parameterJson.length; i++) {\n                  _loop2(i);\n                }\n                _this2.interfaceParam = parameterJson;\n              });\n            case 4:\n              if (!(!this.tables.length && webType != 4)) {\n                _context3.next = 8;\n                break;\n              }\n              this.loading = false;\n              this.$nextTick(function () {\n                return _this2.next();\n              });\n              return _context3.abrupt(\"return\");\n            case 8:\n              this.dataForm.dbLinkId = this.dataForm.dbLinkId || '0';\n              type = this.dataForm.type;\n              queryType = 0;\n              if (type == 3 || type == 4 || type == 5) queryType = 1;\n              i = 0;\n            case 13:\n              if (!(i < this.tables.length)) {\n                _context3.next = 23;\n                break;\n              }\n              _context3.next = 16;\n              return (0, _dataModel.DataModelFieldList)(this.dataForm.dbLinkId, this.tables[i].table, queryType);\n            case 16:\n              res = _context3.sent;\n              fields = res.data.list;\n              this.tables[i].fields = fields;\n              if (this.tables[i].typeId == '1') {\n                this.mainTableFields = this.tables[i].fields;\n                this.relationTable = this.tables[i].table;\n              }\n            case 20:\n              i++;\n              _context3.next = 13;\n              break;\n            case 23:\n              this.loading = false;\n              if (webType != 4) {\n                this.$nextTick(function () {\n                  _this2.next();\n                });\n              }\n            case 25:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee2, this);\n      }));\n      function updateFields(_x2) {\n        return _updateFields.apply(this, arguments);\n      }\n      return updateFields;\n    }(),\n    getDbOptions: function getDbOptions() {\n      var _this3 = this;\n      (0, _dataSource.getDataSourceListAll)().then(function (res) {\n        var list = res.data.list || [];\n        _this3.dbOptions = list.filter(function (o) {\n          return o.children && o.children.length;\n        });\n      });\n    },\n    getDbType: function getDbType() {\n      for (var i = 0; i < this.dbOptions.length; i++) {\n        var e = this.dbOptions[i].children;\n        for (var j = 0; j < e.length; j++) {\n          if (this.dataForm.dbLinkId === e[j].id) {\n            this.dbType = e[j].dbType;\n            break;\n          }\n        }\n      }\n    },\n    delItem: function delItem(row, index) {\n      var _this4 = this;\n      this.$confirm(\"确定要移除当前行？\", this.$t('common.tipTitle'), {\n        type: 'warning'\n      }).then(function () {\n        _this4.tables.splice(index, 1);\n        if (row.typeId == '1' && _this4.tables.length) {\n          _this4.tables[0].typeId = '1';\n          _this4.tables[0].relationTable = '';\n          _this4.mainTableFields = _this4.tables[0].fields;\n          _this4.relationTable = _this4.tables[0].table;\n        }\n      }).catch(function () {});\n    },\n    changeTable: function changeTable(row) {\n      this.relationTable = row.table;\n      this.mainTableFields = row.fields;\n      for (var i = 0; i < this.tables.length; i++) {\n        this.$set(this.tables[i], \"typeId\", this.tables[i].table === row.table ? '1' : '0');\n        this.$set(this.tables[i], \"relationTable\", this.tables[i].table === row.table ? '' : this.relationTable);\n        this.$set(this.tables[i], \"relationField\", \"\");\n        this.$set(this.tables[i], \"tableField\", \"\");\n      }\n    },\n    getFormInfo: function getFormInfo() {\n      return this.dataForm;\n    },\n    exist: function exist() {\n      var isOk = true;\n      for (var i = 0; i < this.tables.length; i++) {\n        var e = this.tables[i];\n        if (e.typeId == '0') {\n          if (!e.tableField) {\n            this.$message({\n              showClose: true,\n              message: \"\\u8868\".concat(e.table, \"\\u5916\\u952E\\u5B57\\u6BB5\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n              type: 'warning',\n              duration: 1000\n            });\n            isOk = false;\n            break;\n          }\n        }\n        if (e.typeId == '0') {\n          if (!e.relationField) {\n            this.$message({\n              showClose: true,\n              message: \"\\u8868\".concat(e.table, \"\\u5173\\u8054\\u4E3B\\u952E\\u4E0D\\u80FD\\u4E3A\\u7A7A\"),\n              type: 'warning',\n              duration: 1000\n            });\n            isOk = false;\n            break;\n          }\n        }\n      }\n      return isOk;\n    }\n  }\n};",null]}