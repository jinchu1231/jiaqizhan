{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/src/views/dashboard/mixin.js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/views/dashboard/mixin.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es7.array.includes\");\nrequire(\"core-js/modules/es6.string.includes\");\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _Layout = _interopRequireDefault(require(\"@/components/VisualPortal/Layout\"));\nvar _portal = require(\"@/api/onlineDev/portal\");\nvar _dataInterface = require(\"@/api/systemData/dataInterface\");\nvar _vuex = require(\"vuex\");\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nvar _default = exports.default = {\n  components: {\n    PortalLayout: _Layout.default\n  },\n  data: function data() {\n    return {\n      portalId: '',\n      layout: [],\n      type: null,\n      linkType: null,\n      currentView: null,\n      url: '',\n      ajaxing: true,\n      loading: false,\n      noData: false,\n      refreshData: {},\n      timerList: [],\n      formData: {},\n      enabledLock: 1,\n      systemId: ''\n    };\n  },\n  computed: _objectSpread({}, (0, _vuex.mapGetters)(['userInfo'])),\n  destroyed: function destroyed() {\n    this.clearAutoRefresh();\n  },\n  methods: {\n    getData: function getData() {\n      var _this = this;\n      this.loading = true;\n      this.layout = [];\n      this.noData = false;\n      if (!this.portalId) {\n        this.loading = false;\n        this.ajaxing = false;\n        this.noData = true;\n        return;\n      }\n      (0, _portal.getAuthPortal)(this.portalId, {\n        platform: 'Web',\n        systemId: this.systemId\n      }).then(function (res) {\n        if (res.code != 200) {\n          _this.$message({\n            message: res.msg,\n            type: 'error',\n            duration: 1500,\n            onClose: function onClose() {\n              _this.loading = false;\n              _this.ajaxing = false;\n              _this.noData = true;\n              return;\n            }\n          });\n        }\n        if (res.data) {\n          _this.type = res.data.type || 0;\n          _this.linkType = res.data.linkType || 0;\n          _this.url = res.data.customUrl || '';\n          _this.enabledLock = res.data.enabledLock || 0;\n          if (res.data.type === 1) {\n            if (res.data.customUrl && res.data.customUrl !== 1) {\n              _this.currentView = function (resolve) {\n                return require([\"@/views/\".concat(res.data.customUrl)], resolve);\n              };\n            }\n          } else {\n            if (res.data.formData) {\n              _this.formData = JSON.parse(res.data.formData);\n              _this.layout = _this.filterList(JSON.parse(JSON.stringify(_this.formData.layout)) || []);\n              _this.refreshData = _this.formData.refresh || {};\n            }\n          }\n        }\n        _this.ajaxing = false;\n        setTimeout(function () {\n          _this.initAutoRefresh();\n          _this.loading = false;\n        }, 500);\n      }).catch(function () {\n        _this.loading = false;\n        _this.ajaxing = false;\n        _this.noData = true;\n      });\n    },\n    filterList: function filterList(layout) {\n      var loop = function loop(list) {\n        for (var i = 0; i < list.length; i++) {\n          var item = list[i];\n          if (!(Array.isArray(item.visibility) && item.visibility.includes('pc')) && item.jnpfKey) {\n            list.splice(i, 1);\n            i--;\n          }\n          if (item.children && item.children.length) loop(item.children);\n        }\n      };\n      loop(layout);\n      return layout;\n    },\n    initAutoRefresh: function initAutoRefresh() {\n      var _this2 = this;\n      if (!this.layout.length) return;\n      this.timerList = [];\n      var loop = function loop(list) {\n        var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n        list.forEach(function (ele) {\n          if (ele.refresh && ele.refresh.autoRefresh && ele.refresh.autoRefreshTime || type == 2) {\n            var timer = setInterval(function () {\n              ele.renderKey = +new Date();\n              _this2.autoRefresh(ele);\n            }, type == 2 ? _this2.refreshData.autoRefreshTime * 1000 * 60 : ele.refresh.autoRefreshTime * 1000 * 60);\n            _this2.timerList.push(timer);\n          }\n          if (ele.children && ele.children.length) loop(ele.children, type);\n        });\n      };\n      if (this.refreshData.autoRefresh) {\n        loop(this.layout, 2);\n      } else {\n        loop(this.layout);\n      }\n    },\n    autoRefresh: function autoRefresh(item) {\n      var chartList = ['barChart', 'lineChart', 'pieChart', 'radarChart', 'mapChart'];\n      if (item.dataType === 'dynamic' && chartList.includes(item.jnpfKey)) {\n        if (!item.propsApi) return;\n        (0, _dataInterface.getDataInterfaceRes)(item.propsApi).then(function (res) {\n          var realData = res.data;\n          if (Array.isArray(realData)) {\n            item.option.defaultValue = realData;\n          } else {\n            item.option.defaultValue = [];\n          }\n        });\n      }\n    },\n    clearAutoRefresh: function clearAutoRefresh() {\n      if (this.timerList.length) {\n        this.timerList.forEach(function (ele) {\n          if (ele) clearInterval(ele);\n        });\n      }\n    },\n    layoutUpdatedEvent: function layoutUpdatedEvent() {\n      this.formData.layout = this.layout;\n      var query = {\n        formData: JSON.stringify(this.formData),\n        systemId: this.systemId\n      };\n      (0, _portal.UpdateCustomPortal)(this.portalId, query).then(function (res) {});\n    }\n  }\n};",null]}