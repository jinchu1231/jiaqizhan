{"remainingRequest":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js!/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js??vue-loader-options!/Users/交安/gas/vue/gas-web/src/components/integrationProcess/PropPanel/StartNode.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/交安/gas/vue/gas-web/src/components/integrationProcess/PropPanel/StartNode.vue","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/babel.config.js","mtime":1706684850000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_babel-loader@8.3.0@babel-loader/lib/index.js","mtime":456789000000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/交安/gas/vue/gas-web/node_modules/_vue-loader@15.11.1@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime@7.24.5@@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/web.dom.iterable\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es6.array.find-index\");\nvar _defineProperty2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/defineProperty.js\"));\nvar _slicedToArray2 = _interopRequireDefault(require(\"/Users/\\u4EA4\\u5B89/gas/vue/gas-web/node_modules/_@babel_runtime-corejs2@7.24.5@@babel/runtime-corejs2/helpers/slicedToArray.js\"));\nrequire(\"core-js/modules/es7.array.includes\");\nrequire(\"core-js/modules/es6.string.includes\");\nrequire(\"core-js/modules/es6.number.constructor\");\nvar _FormListModal = _interopRequireDefault(require(\"./FormListModal\"));\nvar _condition = _interopRequireDefault(require(\"@/components/ColumnDesign/condition\"));\nvar _define = require(\"../FlowCard/define.js\");\nvar _msgDialog = _interopRequireDefault(require(\"@/components/Process/PropPanel/msgDialog\"));\nvar _TemplateDetail = _interopRequireDefault(require(\"@/components/Process/PropPanel/TemplateDetail\"));\nvar _vcrontab = _interopRequireDefault(require(\"vcrontab\"));\nvar _clipboard = _interopRequireDefault(require(\"@/utils/clipboard\"));\nvar _BatchDialog = _interopRequireDefault(require(\"./model/BatchDialog\"));\nvar _WebhookRequestDialog = _interopRequireDefault(require(\"./model/WebhookRequestDialog\"));\nvar _store = _interopRequireDefault(require(\"@/store\"));\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { (0, _defineProperty2.default)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; } //\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar triggerEventOptions = [{\n  id: 1,\n  fullName: '新增数据'\n}, {\n  id: 2,\n  fullName: '修改数据'\n}, {\n  id: 3,\n  fullName: '删除数据'\n}];\nvar endTimeTypeOptions = [{\n  id: 1,\n  fullName: '触发次数'\n}, {\n  id: 2,\n  fullName: '指定时间'\n}, {\n  id: 3,\n  fullName: '不结束'\n}];\nvar _default2 = exports.default = {\n  name: 'StartNode',\n  components: {\n    FlowFormModal: _FormListModal.default,\n    Condition: _condition.default,\n    MsgDialog: _msgDialog.default,\n    Detail: _TemplateDetail.default,\n    vcrontab: _vcrontab.default,\n    BatchDialog: _BatchDialog.default,\n    WebhookRequestDialog: _WebhookRequestDialog.default\n  },\n  props: {\n    formConf: {\n      type: Object,\n      default: function _default() {}\n    },\n    integrateType: {\n      type: Number,\n      default: 1\n    },\n    formFieldsOptions: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    getFormFieldList: {\n      type: Function,\n      default: null\n    },\n    formInfo: {\n      type: Object,\n      default: function _default() {}\n    }\n  },\n  data: function data() {\n    return {\n      activeKey: '1',\n      triggerEventOptions: triggerEventOptions,\n      columnOptions: [],\n      msgUserOptions: _define.msgUserOptions,\n      props: {\n        label: \"fullName\",\n        value: \"id\"\n      },\n      noticeOptions: _define.noticeOptions,\n      viewVisible: false,\n      showCron: false,\n      showCrontab: true,\n      endTimeTypeOptions: endTimeTypeOptions,\n      jsonVisible: false,\n      webhookRequestVisible: false,\n      formId: JSON.parse(JSON.stringify(this.formConf.formId))\n    };\n  },\n  created: function created() {\n    if (this.integrateType == 3) this.formConf.formFieldList = this.formConf.formFieldList.filter(function (o) {\n      return o.id !== '@formId';\n    });\n  },\n  computed: {\n    formFieldList: function formFieldList() {\n      return this.formConf.formFieldList.filter(function (o) {\n        return o.id.indexOf('-') < 0;\n      });\n    },\n    getWebhookUrl: function getWebhookUrl() {\n      var sysConfig = _store.default.getters && _store.default.getters.sysConfig;\n      return sysConfig.jnpfDomain + this.formConf.webhookUrl;\n    }\n  },\n  methods: {\n    getFormConf: function getFormConf() {\n      var isOk = false;\n      if (this.integrateType == 1) {\n        if (!this.formConf.formId) {\n          this.$message.error('请选择触发表单');\n          return isOk;\n        }\n        var item = this.$refs.base && this.$refs.base.getData() || '';\n        if (!item) return isOk;\n        this.formConf.ruleMatchLogic = item.matchLogic;\n        this.formConf.ruleList = item.conditionList;\n        if (!this.formConf.ruleList || !this.validData()) {\n          return isOk;\n        }\n      } else if (this.integrateType == 2) {\n        if (!this.formConf.startTime) {\n          this.$message.error('请选择触发开始时间');\n          return isOk;\n        }\n        if (!this.formConf.cron) {\n          this.$message.error('请设置Cron表达式');\n          return isOk;\n        }\n        if (this.formConf.endTimeType == 2 && !this.formConf.endTime) {\n          this.$message.error('请选择触发结束时间');\n          return isOk;\n        }\n        if (this.formConf.startMsgConfig.on == 1 && !this.formConf.startMsgConfig.msgId) {\n          this.$message.error('请选择开始执行发送配置');\n          return isOk;\n        }\n        if (this.formConf.failMsgConfig.on == 1 && !this.formConf.failMsgConfig.msgId) {\n          this.$message.error('请选择执行失败发送配置');\n          return isOk;\n        }\n      } else {\n        if (!this.formConf.formFieldList.length) {\n          this.$message.error('请设置接口字段');\n          return isOk;\n        }\n        if (!this.formFieldListExist()) return;\n        if (this.formConf.failMsgConfig.on === 1 && !this.formConf.failMsgConfig.msgId) {\n          this.$message.error('请选择执行失败发送配置');\n        }\n        if (this.formConf.startMsgConfig.on === 1 && !this.formConf.startMsgConfig.msgId) {\n          this.$message.error('请选择开始执行发送配置');\n          return isOk;\n        }\n      }\n      return this.formConf;\n    },\n    getCrontabValue: function getCrontabValue() {\n      this.$refs.vcrontab && this.$refs.vcrontab.submitFill();\n    },\n    resetCrontab: function resetCrontab() {\n      this.$refs.vcrontab && this.$refs.vcrontab.clearCron();\n    },\n    crontabFill: function crontabFill(value) {\n      this.formConf.cron = value;\n    },\n    showDialog: function showDialog() {\n      this.showCron = true;\n      this.showCrontab = true;\n    },\n    validData: function validData() {\n      var isOk = true;\n      for (var i = 0; i < this.formConf.ruleList.length; i++) {\n        var e = this.formConf.ruleList[i];\n        for (var j = 0; j < e.groups.length; j++) {\n          var child = e.groups[j];\n          if (!child.field) {\n            this.$message.warning('条件字段不能为空');\n            isOk = false;\n            break;\n          }\n          if (!child.symbol) {\n            this.$message.warning('条件符号不能为空');\n            isOk = false;\n            break;\n          }\n          if (!['null', 'notNull'].includes(child.symbol) && !['switch'].includes(child.jnpfKey) && (!child.fieldValue || this.jnpf.isEmpty(child.fieldValue)) && (!['inputNumber', 'calculate', 'rate'].includes(child.jnpfKey) || ['inputNumber', 'calculate', 'rate'].includes(child.jnpfKey) && child.fieldValue !== 0)) {\n            this.$message.warning('数据值不能为空');\n            isOk = false;\n            break;\n          }\n        }\n      }\n      return isOk;\n    },\n    onFormIdChange: function onFormIdChange(id, item) {\n      if (!id) return this.handleNull();\n      this.formConf.ruleList = [];\n      this.getFormFieldList(id, 'start');\n      if (this.formConf.formId == id) return;\n      this.formConf.formName = item.fullName;\n      this.formConf.formId = id;\n    },\n    handleNull: function handleNull() {\n      this.formConf.formName = '';\n      this.formConf.formId = '';\n      this.formConf.formFieldList = [];\n      this.formConf.ruleList = [];\n    },\n    onRelationFieldChange: function onRelationFieldChange(val, item) {\n      if (!val) return;\n      var list = this.formFieldsOptions.filter(function (o) {\n        return val === o.__vModel__;\n      });\n      if (!list.length) return;\n      var obj = list[0];\n      this.$set(item, 'isSubTable', obj.__config__ && obj.__config__.isSubTable ? obj.__config__.isSubTable : false);\n    },\n    onMsgChange: function onMsgChange(obj, key, params) {\n      var _params = (0, _slicedToArray2.default)(params, 2),\n        id = _params[0],\n        item = _params[1];\n      if (!id) {\n        this[obj][key].msgId = '';\n        this[obj][key].msgName = '';\n        this[obj][key].templateJson = [];\n        return;\n      }\n      if (this[obj][key].msgId === id) return;\n      this[obj][key].msgId = id;\n      this[obj][key].msgName = item.fullName;\n      this[obj][key].templateJson = item.templateJson;\n    },\n    goDetail: function goDetail(id) {\n      var _this = this;\n      this.viewVisible = true;\n      this.$nextTick(function () {\n        _this.$refs.View.init(id);\n      });\n    },\n    oneEndLimitChange: function oneEndLimitChange(val) {\n      var _this2 = this;\n      this.$nextTick(function () {\n        if (!val) _this2.formConf.endLimit = 1;\n      });\n    },\n    addItem: function addItem() {\n      this.formConf.formFieldList.push({\n        id: '',\n        fullName: '',\n        label: ''\n      });\n    },\n    delItem: function delItem(index) {\n      this.formConf.formFieldList.splice(index, 1);\n    },\n    onItemChange: function onItemChange(item) {\n      item.label = item.fullName ? item.id + '(' + item.fullName + ')' : item.id;\n    },\n    handleCopy: function handleCopy(event) {\n      (0, _clipboard.default)(this.getWebhookUrl, event);\n    },\n    openBatch: function openBatch() {\n      var _this3 = this;\n      this.jsonVisible = true;\n      this.$nextTick(function () {\n        _this3.$refs.jsonBatch.init();\n      });\n    },\n    openWebhookRequest: function openWebhookRequest() {\n      var _this4 = this;\n      this.webhookRequestVisible = true;\n      this.$nextTick(function () {\n        _this4.$refs.webhookRequest.init({\n          url: _this4.formConf.webhookGetFieldsUrl,\n          randomStr: _this4.formConf.webhookRandomStr,\n          id: _this4.formInfo.id\n        });\n      });\n    },\n    addItemForOther: function addItemForOther(data) {\n      var _this5 = this;\n      this.webhookRequestVisible = false;\n      this.jsonVisible = false;\n      var list = data.map(function (o) {\n        return _objectSpread(_objectSpread({}, o), {}, {\n          label: o.fullName ? o.id + '(' + o.fullName + ')' : o.id\n        });\n      });\n      if (!this.formConf.formFieldList.length) return this.formConf.formFieldList = list;\n      var _loop = function _loop() {\n        var e = list[i];\n        if (!e.id) {\n          _this5.formConf.formFieldList.push(e);\n        } else {\n          var findIndex = _this5.formConf.formFieldList.findIndex(function (o) {\n            return o.id === e.id;\n          });\n          findIndex < 0 ? _this5.formConf.formFieldList.push(e) : _this5.formConf.formFieldList[findIndex] = e;\n        }\n      };\n      for (var i = 0; i < list.length; i++) {\n        _loop();\n      }\n    },\n    // webhook接口字段验证\n    formFieldListExist: function formFieldListExist() {\n      var list = this.formConf.formFieldList;\n      var isOk = true;\n      for (var i = 0; i < list.length; i++) {\n        var e = list[i];\n        if (!e.id) {\n          this.$message.warning(\"\\u7B2C\".concat(i + 1, \"\\u884C\\u5B57\\u6BB5\\u4E0D\\u80FD\\u4E3A\\u7A7A\"));\n          isOk = false;\n          break;\n        }\n        if (!e.fullName) {\n          this.$message.warning(\"\\u7B2C\".concat(i + 1, \"\\u884C\\u5B57\\u6BB5\\u8BF4\\u660E\\u4E0D\\u80FD\\u4E3A\\u7A7A\"));\n          isOk = false;\n          break;\n        }\n      }\n      return isOk;\n    }\n  }\n};",null]}